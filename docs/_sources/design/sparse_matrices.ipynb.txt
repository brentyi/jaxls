{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "cell-0",
   "metadata": {},
   "source": [
    "#",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "c",
    "e",
    "s",
    "\n",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "s",
    " ",
    "n",
    "o",
    "n",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "l",
    "e",
    "a",
    "s",
    "t",
    " ",
    "s",
    "q",
    "u",
    "a",
    "r",
    "e",
    "s",
    " ",
    "u",
    "s",
    "i",
    "n",
    "g",
    " ",
    "L",
    "e",
    "v",
    "e",
    "n",
    "b",
    "e",
    "r",
    "g",
    "-",
    "M",
    "a",
    "r",
    "q",
    "u",
    "a",
    "r",
    "d",
    "t",
    ",",
    " ",
    "w",
    "h",
    "i",
    "c",
    "h",
    " ",
    "i",
    "s",
    " ",
    "b",
    "a",
    "s",
    "e",
    "d",
    " ",
    "o",
    "n",
    "\n",
    "t",
    "h",
    "e",
    " ",
    "G",
    "a",
    "u",
    "s",
    "s",
    "-",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "m",
    "e",
    "t",
    "h",
    "o",
    "d",
    ".",
    "\n",
    "\n",
    "T",
    "h",
    "i",
    "s",
    " ",
    "p",
    "a",
    "g",
    "e",
    " ",
    "d",
    "i",
    "s",
    "c",
    "u",
    "s",
    "s",
    "e",
    "s",
    ":",
    "\n",
    "-",
    " ",
    "T",
    "h",
    "e",
    " ",
    "G",
    "a",
    "u",
    "s",
    "s",
    "-",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "a",
    "p",
    "p",
    "r",
    "o",
    "x",
    "i",
    "m",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "a",
    "n",
    "d",
    " ",
    "w",
    "h",
    "y",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    " ",
    "s",
    "t",
    "r",
    "u",
    "c",
    "t",
    "u",
    "r",
    "e",
    " ",
    "m",
    "a",
    "t",
    "t",
    "e",
    "r",
    "s",
    "\n",
    "-",
    " ",
    "j",
    "a",
    "x",
    "l",
    "s",
    "'",
    "s",
    " ",
    "`",
    "B",
    "l",
    "o",
    "c",
    "k",
    "R",
    "o",
    "w",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    "`",
    " ",
    "r",
    "e",
    "p",
    "r",
    "e",
    "s",
    "e",
    "n",
    "t",
    "a",
    "t",
    "i",
    "o",
    "n",
    ",",
    " ",
    "w",
    "h",
    "i",
    "c",
    "h",
    " ",
    "i",
    "s",
    " ",
    "d",
    "e",
    "s",
    "i",
    "g",
    "n",
    "e",
    "d",
    " ",
    "t",
    "o",
    " ",
    "b",
    "e",
    " ",
    "G",
    "P",
    "U",
    "-",
    "f",
    "r",
    "i",
    "e",
    "n",
    "d",
    "l",
    "y",
    "\n",
    "-",
    " ",
    "L",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "s",
    " ",
    "a",
    "n",
    "d",
    " ",
    "p",
    "r",
    "e",
    "c",
    "o",
    "n",
    "d",
    "i",
    "t",
    "i",
    "o",
    "n",
    "i",
    "n",
    "g",
    " ",
    "s",
    "t",
    "r",
    "a",
    "t",
    "e",
    "g",
    "i",
    "e",
    "s"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-2",
   "metadata": {},
   "source": [
    "#",
    "#",
    " ",
    "T",
    "h",
    "e",
    " ",
    "G",
    "a",
    "u",
    "s",
    "s",
    "-",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "a",
    "p",
    "p",
    "r",
    "o",
    "x",
    "i",
    "m",
    "a",
    "t",
    "i",
    "o",
    "n",
    "\n",
    "\n",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    "'",
    "s",
    " ",
    "m",
    "e",
    "t",
    "h",
    "o",
    "d",
    " ",
    "f",
    "o",
    "r",
    " ",
    "m",
    "i",
    "n",
    "i",
    "m",
    "i",
    "z",
    "i",
    "n",
    "g",
    " ",
    "$",
    "f",
    "(",
    "x",
    ")",
    " ",
    "=",
    " ",
    "\\",
    "f",
    "r",
    "a",
    "c",
    "{",
    "1",
    "}",
    "{",
    "2",
    "}",
    "\\",
    "s",
    "u",
    "m",
    "_",
    "i",
    " ",
    "\\",
    "|",
    "r",
    "_",
    "i",
    "(",
    "x",
    ")",
    "\\",
    "|",
    "^",
    "2",
    "$",
    " ",
    "r",
    "e",
    "q",
    "u",
    "i",
    "r",
    "e",
    "s",
    " ",
    "t",
    "h",
    "e",
    "\n",
    "H",
    "e",
    "s",
    "s",
    "i",
    "a",
    "n",
    " ",
    "$",
    "\\",
    "n",
    "a",
    "b",
    "l",
    "a",
    "^",
    "2",
    " ",
    "f",
    "$",
    ",",
    " ",
    "w",
    "h",
    "i",
    "c",
    "h",
    " ",
    "i",
    "s",
    " ",
    "e",
    "x",
    "p",
    "e",
    "n",
    "s",
    "i",
    "v",
    "e",
    " ",
    "t",
    "o",
    " ",
    "c",
    "o",
    "m",
    "p",
    "u",
    "t",
    "e",
    ".",
    " ",
    "G",
    "a",
    "u",
    "s",
    "s",
    "-",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "i",
    "n",
    "s",
    "t",
    "e",
    "a",
    "d",
    " ",
    "a",
    "p",
    "p",
    "r",
    "o",
    "x",
    "i",
    "m",
    "a",
    "t",
    "e",
    "s",
    "\n",
    "t",
    "h",
    "e",
    " ",
    "H",
    "e",
    "s",
    "s",
    "i",
    "a",
    "n",
    " ",
    "u",
    "s",
    "i",
    "n",
    "g",
    " ",
    "o",
    "n",
    "l",
    "y",
    " ",
    "f",
    "i",
    "r",
    "s",
    "t",
    "-",
    "o",
    "r",
    "d",
    "e",
    "r",
    " ",
    "i",
    "n",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    "i",
    "o",
    "n",
    ":",
    "\n",
    "\n",
    "$",
    "$",
    "\\",
    "n",
    "a",
    "b",
    "l",
    "a",
    "^",
    "2",
    " ",
    "f",
    " ",
    "\\",
    "a",
    "p",
    "p",
    "r",
    "o",
    "x",
    " ",
    "J",
    "^",
    "\\",
    "t",
    "o",
    "p",
    " ",
    "J",
    "$",
    "$",
    "\n",
    "\n",
    "w",
    "h",
    "e",
    "r",
    "e",
    " ",
    "$",
    "J",
    " ",
    "=",
    " ",
    "\\",
    "p",
    "a",
    "r",
    "t",
    "i",
    "a",
    "l",
    " ",
    "r",
    " ",
    "/",
    " ",
    "\\",
    "p",
    "a",
    "r",
    "t",
    "i",
    "a",
    "l",
    " ",
    "x",
    "$",
    " ",
    "i",
    "s",
    " ",
    "t",
    "h",
    "e",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    " ",
    "o",
    "f",
    " ",
    "t",
    "h",
    "e",
    " ",
    "s",
    "t",
    "a",
    "c",
    "k",
    "e",
    "d",
    " ",
    "r",
    "e",
    "s",
    "i",
    "d",
    "u",
    "a",
    "l",
    " ",
    "v",
    "e",
    "c",
    "t",
    "o",
    "r",
    "\n",
    "$",
    "r",
    "(",
    "x",
    ")",
    " ",
    "=",
    " ",
    "[",
    "r",
    "_",
    "0",
    "(",
    "x",
    ")",
    "^",
    "\\",
    "t",
    "o",
    "p",
    ",",
    " ",
    "r",
    "_",
    "1",
    "(",
    "x",
    ")",
    "^",
    "\\",
    "t",
    "o",
    "p",
    ",",
    " ",
    "\\",
    "l",
    "d",
    "o",
    "t",
    "s",
    "]",
    "^",
    "\\",
    "t",
    "o",
    "p",
    "$",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "r",
    "e",
    "s",
    "p",
    "e",
    "c",
    "t",
    " ",
    "t",
    "o",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    " ",
    "t",
    "a",
    "n",
    "g",
    "e",
    "n",
    "t",
    "\n",
    "v",
    "e",
    "c",
    "t",
    "o",
    "r",
    "s",
    " ",
    "(",
    "f",
    "o",
    "r",
    " ",
    "E",
    "u",
    "c",
    "l",
    "i",
    "d",
    "e",
    "a",
    "n",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    ",",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "i",
    "s",
    " ",
    "j",
    "u",
    "s",
    "t",
    " ",
    "$",
    "\\",
    "p",
    "a",
    "r",
    "t",
    "i",
    "a",
    "l",
    " ",
    "r",
    " ",
    "/",
    " ",
    "\\",
    "p",
    "a",
    "r",
    "t",
    "i",
    "a",
    "l",
    " ",
    "x",
    "$",
    ")",
    ".",
    "\n",
    "\n",
    "#",
    "#",
    " ",
    "W",
    "h",
    "y",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    "s",
    " ",
    "a",
    "r",
    "e",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "\n",
    "\n",
    "R",
    "e",
    "s",
    "i",
    "d",
    "u",
    "a",
    "l",
    " ",
    "t",
    "e",
    "r",
    "m",
    "s",
    " ",
    "i",
    "n",
    " ",
    "n",
    "o",
    "n",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "l",
    "e",
    "a",
    "s",
    "t",
    " ",
    "s",
    "q",
    "u",
    "a",
    "r",
    "e",
    "s",
    " ",
    "o",
    "f",
    "t",
    "e",
    "n",
    " ",
    "d",
    "e",
    "p",
    "e",
    "n",
    "d",
    " ",
    "o",
    "n",
    " ",
    "o",
    "n",
    "l",
    "y",
    " ",
    "a",
    " ",
    "s",
    "u",
    "b",
    "s",
    "e",
    "t",
    " ",
    "o",
    "f",
    " ",
    "t",
    "h",
    "e",
    "\n",
    "o",
    "p",
    "t",
    "i",
    "m",
    "i",
    "z",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    ".",
    " ",
    "F",
    "o",
    "r",
    " ",
    "e",
    "x",
    "a",
    "m",
    "p",
    "l",
    "e",
    ",",
    " ",
    "a",
    " ",
    "p",
    "a",
    "i",
    "r",
    "w",
    "i",
    "s",
    "e",
    " ",
    "c",
    "o",
    "s",
    "t",
    " ",
    "b",
    "e",
    "t",
    "w",
    "e",
    "e",
    "n",
    " ",
    "t",
    "w",
    "o",
    " ",
    "p",
    "o",
    "s",
    "e",
    "s",
    " ",
    "o",
    "n",
    "l",
    "y",
    " ",
    "d",
    "e",
    "p",
    "e",
    "n",
    "d",
    "s",
    "\n",
    "o",
    "n",
    " ",
    "t",
    "h",
    "o",
    "s",
    "e",
    " ",
    "t",
    "w",
    "o",
    " ",
    "p",
    "o",
    "s",
    "e",
    "s",
    ",",
    " ",
    "n",
    "o",
    "t",
    " ",
    "t",
    "h",
    "e",
    " ",
    "h",
    "u",
    "n",
    "d",
    "r",
    "e",
    "d",
    "s",
    " ",
    "o",
    "f",
    " ",
    "o",
    "t",
    "h",
    "e",
    "r",
    " ",
    "p",
    "o",
    "s",
    "e",
    "s",
    " ",
    "i",
    "n",
    " ",
    "a",
    " ",
    "S",
    "L",
    "A",
    "M",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    " ",
    "T",
    "h",
    "i",
    "s",
    " ",
    "p",
    "r",
    "o",
    "d",
    "u",
    "c",
    "e",
    "s",
    "\n",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    "s",
    ":",
    " ",
    "r",
    "o",
    "w",
    " ",
    "b",
    "l",
    "o",
    "c",
    "k",
    " ",
    "$",
    "i",
    "$",
    " ",
    "o",
    "f",
    " ",
    "$",
    "J",
    "$",
    " ",
    "h",
    "a",
    "s",
    " ",
    "n",
    "o",
    "n",
    "-",
    "z",
    "e",
    "r",
    "o",
    "s",
    " ",
    "o",
    "n",
    "l",
    "y",
    " ",
    "i",
    "n",
    " ",
    "c",
    "o",
    "l",
    "u",
    "m",
    "n",
    "s",
    " ",
    "c",
    "o",
    "r",
    "r",
    "e",
    "s",
    "p",
    "o",
    "n",
    "d",
    "i",
    "n",
    "g",
    "\n",
    "t",
    "o",
    " ",
    "t",
    "h",
    "e",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    " ",
    "t",
    "h",
    "a",
    "t",
    " ",
    "$",
    "r",
    "_",
    "i",
    "$",
    " ",
    "d",
    "e",
    "p",
    "e",
    "n",
    "d",
    "s",
    " ",
    "o",
    "n",
    ".",
    "\n",
    "\n",
    "T",
    "h",
    "i",
    "s",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "i",
    "t",
    "y",
    " ",
    "p",
    "a",
    "t",
    "t",
    "e",
    "r",
    "n",
    " ",
    "c",
    "o",
    "r",
    "r",
    "e",
    "s",
    "p",
    "o",
    "n",
    "d",
    "s",
    " ",
    "t",
    "o",
    " ",
    "t",
    "h",
    "e",
    " ",
    "a",
    "d",
    "j",
    "a",
    "c",
    "e",
    "n",
    "c",
    "y",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "o",
    "f",
    " ",
    "a",
    " ",
    "b",
    "i",
    "p",
    "a",
    "r",
    "t",
    "i",
    "t",
    "e",
    " ",
    "f",
    "a",
    "c",
    "t",
    "o",
    "r",
    " ",
    "g",
    "r",
    "a",
    "p",
    "h",
    ":",
    "\n",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "V",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    "*",
    "*",
    " ",
    "(",
    "c",
    "i",
    "r",
    "c",
    "l",
    "e",
    "s",
    ")",
    ":",
    " ",
    "T",
    "h",
    "e",
    " ",
    "p",
    "a",
    "r",
    "a",
    "m",
    "e",
    "t",
    "e",
    "r",
    "s",
    " ",
    "w",
    "e",
    "'",
    "r",
    "e",
    " ",
    "o",
    "p",
    "t",
    "i",
    "m",
    "i",
    "z",
    "i",
    "n",
    "g",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "C",
    "o",
    "s",
    "t",
    "s",
    "*",
    "*",
    " ",
    "(",
    "s",
    "q",
    "u",
    "a",
    "r",
    "e",
    "s",
    ")",
    ":",
    " ",
    "R",
    "e",
    "s",
    "i",
    "d",
    "u",
    "a",
    "l",
    " ",
    "f",
    "u",
    "n",
    "c",
    "t",
    "i",
    "o",
    "n",
    "s",
    " ",
    "t",
    "h",
    "a",
    "t",
    " ",
    "c",
    "o",
    "n",
    "n",
    "e",
    "c",
    "t",
    " ",
    "t",
    "o",
    " ",
    "t",
    "h",
    "e",
    "i",
    "r",
    " ",
    "d",
    "e",
    "p",
    "e",
    "n",
    "d",
    "e",
    "n",
    "t",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    "\n",
    "\n",
    "C",
    "o",
    "n",
    "s",
    "i",
    "d",
    "e",
    "r",
    " ",
    "a",
    "n",
    " ",
    "o",
    "p",
    "t",
    "i",
    "m",
    "i",
    "z",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    " ",
    "$",
    "x",
    "_",
    "0",
    "$",
    ",",
    " ",
    "$",
    "x",
    "_",
    "1",
    "$",
    ",",
    " ",
    "$",
    "x",
    "_",
    "2",
    "$",
    " ",
    "a",
    "n",
    "d",
    " ",
    "t",
    "h",
    "r",
    "e",
    "e",
    " ",
    "t",
    "y",
    "p",
    "e",
    "s",
    "\n",
    "o",
    "f",
    " ",
    "c",
    "o",
    "s",
    "t",
    "s",
    ":",
    " ",
    "A",
    " ",
    "(",
    "u",
    "n",
    "a",
    "r",
    "y",
    ")",
    ",",
    " ",
    "B",
    " ",
    "(",
    "b",
    "i",
    "n",
    "a",
    "r",
    "y",
    " ",
    "b",
    "e",
    "t",
    "w",
    "e",
    "e",
    "n",
    " ",
    "a",
    "d",
    "j",
    "a",
    "c",
    "e",
    "n",
    "t",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    ")",
    ",",
    " ",
    "a",
    "n",
    "d",
    " ",
    "C",
    " ",
    "(",
    "b",
    "i",
    "n",
    "a",
    "r",
    "y",
    " ",
    "b",
    "e",
    "t",
    "w",
    "e",
    "e",
    "n",
    "\n",
    "n",
    "o",
    "n",
    "-",
    "a",
    "d",
    "j",
    "a",
    "c",
    "e",
    "n",
    "t",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    ")",
    "."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "cell-3",
   "metadata": {
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [],
   "source": [
    "# Internal implementation.\n",
    "\n",
    "import plotly.graph_objects as go\n",
    "from plotly.subplots import make_subplots\n",
    "from IPython.display import HTML\n",
    "import numpy as np\n",
    "\n",
    "# Create a simple problem structure visualization.\n",
    "# Variables: x0 (dim 2), x1 (dim 2), x2 (dim 2)\n",
    "# Cost types: A (unary), B (binary adjacent), C (binary non-adjacent)\n",
    "\n",
    "fig = make_subplots(\n",
    "    rows=1,\n",
    "    cols=2,\n",
    "    subplot_titles=(\"Problem Structure\", \"Jacobian Sparsity Pattern\"),\n",
    "    column_widths=[0.45, 0.55],\n",
    "    horizontal_spacing=0.12,\n",
    ")\n",
    "\n",
    "# Problem structure layout.\n",
    "var_x = [0, 2, 4]\n",
    "var_y = [1, 1, 1]\n",
    "var_labels = [\"x₀\", \"x₁\", \"x₂\"]\n",
    "var_dims = [2, 2, 2]  # Tangent dimensions (all 2D).\n",
    "\n",
    "# C₀ placed above the variables for cleaner layout.\n",
    "cost_x = [0, 1, 3, 4, 2]\n",
    "cost_y = [0, 0, 0, 0, 2]\n",
    "cost_labels = [\"A₀\", \"B₀\", \"B₁\", \"A₁\", \"C₀\"]\n",
    "cost_dims = [2, 2, 2, 2, 2]  # Residual dimensions (all 2).\n",
    "# Colors: A costs (blue), B costs (orange), C costs (green).\n",
    "cost_colors = [\"#1976d2\", \"#f57c00\", \"#f57c00\", \"#1976d2\", \"#388e3c\"]\n",
    "\n",
    "# Connections: (cost_idx, var_idx).\n",
    "# A₀→x₀, B₀→x₀,x₁, B₁→x₁,x₂, A₁→x₂, C₀→x₀,x₂\n",
    "edges = [(0, 0), (1, 0), (1, 1), (2, 1), (2, 2), (3, 2), (4, 0), (4, 2)]\n",
    "\n",
    "# Draw edges.\n",
    "for ci, vi in edges:\n",
    "    fig.add_trace(\n",
    "        go.Scatter(\n",
    "            x=[cost_x[ci], var_x[vi]],\n",
    "            y=[cost_y[ci], var_y[vi]],\n",
    "            mode=\"lines\",\n",
    "            line=dict(color=\"#888\", width=2),\n",
    "            showlegend=False,\n",
    "            hoverinfo=\"skip\",\n",
    "        ),\n",
    "        row=1,\n",
    "        col=1,\n",
    "    )\n",
    "\n",
    "# Draw variables (circles).\n",
    "fig.add_trace(\n",
    "    go.Scatter(\n",
    "        x=var_x,\n",
    "        y=var_y,\n",
    "        mode=\"markers+text\",\n",
    "        marker=dict(size=40, color=\"#2196F3\", line=dict(width=2, color=\"white\")),\n",
    "        text=var_labels,\n",
    "        textposition=\"middle center\",\n",
    "        textfont=dict(color=\"white\", size=14),\n",
    "        name=\"Variables\",\n",
    "        hovertemplate=\"%{text}<br>dim=%{customdata}<extra></extra>\",\n",
    "        customdata=var_dims,\n",
    "    ),\n",
    "    row=1,\n",
    "    col=1,\n",
    ")\n",
    "\n",
    "# Draw costs (squares) - color by cost type.\n",
    "for i, (cx, cy, label, color, dim) in enumerate(\n",
    "    zip(cost_x, cost_y, cost_labels, cost_colors, cost_dims)\n",
    "):\n",
    "    fig.add_trace(\n",
    "        go.Scatter(\n",
    "            x=[cx],\n",
    "            y=[cy],\n",
    "            mode=\"markers+text\",\n",
    "            marker=dict(\n",
    "                size=35, color=color, symbol=\"square\", line=dict(width=2, color=\"white\")\n",
    "            ),\n",
    "            text=[label],\n",
    "            textposition=\"middle center\",\n",
    "            textfont=dict(color=\"white\", size=12),\n",
    "            name=label,\n",
    "            hovertemplate=f\"{label}<br>residual dim={dim}<extra></extra>\",\n",
    "            showlegend=False,\n",
    "        ),\n",
    "        row=1,\n",
    "        col=1,\n",
    "    )\n",
    "\n",
    "# Build Jacobian sparsity pattern.\n",
    "# Order costs by type for the matrix: A₀, A₁, B₀, B₁, C₀\n",
    "cost_order = [0, 3, 1, 2, 4]  # Reorder to group by type.\n",
    "ordered_cost_dims = [cost_dims[i] for i in cost_order]\n",
    "ordered_cost_labels = [cost_labels[i] for i in cost_order]\n",
    "ordered_cost_colors_idx = [0, 0, 1, 1, 2]  # A, A, B, B, C\n",
    "\n",
    "n_rows = sum(ordered_cost_dims)  # 10\n",
    "n_cols = sum(var_dims)  # 6\n",
    "\n",
    "row_starts = [0] + list(np.cumsum(ordered_cost_dims)[:-1])\n",
    "col_starts = [0] + list(np.cumsum(var_dims)[:-1])\n",
    "\n",
    "# Build edge map for reordered costs.\n",
    "# Original edges: A₀→x₀, B₀→x₀,x₁, B₁→x₁,x₂, A₁→x₂, C₀→x₀,x₂\n",
    "# Reordered: A₀→x₀, A₁→x₂, B₀→x₀,x₁, B₁→x₁,x₂, C₀→x₀,x₂\n",
    "reordered_edges = [\n",
    "    (0, [0]),  # A₀ → x₀\n",
    "    (1, [2]),  # A₁ → x₂\n",
    "    (2, [0, 1]),  # B₀ → x₀, x₁\n",
    "    (3, [1, 2]),  # B₁ → x₁, x₂\n",
    "    (4, [0, 2]),  # C₀ → x₀, x₂ (non-adjacent!)\n",
    "]\n",
    "\n",
    "# Create color matrix for heatmap.\n",
    "color_matrix = np.zeros((n_rows, n_cols))\n",
    "color_vals = [1, 1, 2, 2, 3]  # A=1 (blue), B=2 (orange), C=3 (green)\n",
    "for row_idx, (_, var_indices) in enumerate(reordered_edges):\n",
    "    r0, r1 = row_starts[row_idx], row_starts[row_idx] + ordered_cost_dims[row_idx]\n",
    "    for vi in var_indices:\n",
    "        c0, c1 = col_starts[vi], col_starts[vi] + var_dims[vi]\n",
    "        color_matrix[r0:r1, c0:c1] = color_vals[row_idx]\n",
    "\n",
    "# Custom colorscale: white, blue, orange, green.\n",
    "fig.add_trace(\n",
    "    go.Heatmap(\n",
    "        z=color_matrix[::-1],\n",
    "        colorscale=[[0, \"white\"], [0.33, \"#1976d2\"], [0.67, \"#f57c00\"], [1, \"#388e3c\"]],\n",
    "        showscale=False,\n",
    "        zmin=0,\n",
    "        zmax=3,\n",
    "        hovertemplate=\"row %{y}, col %{x}<extra></extra>\",\n",
    "    ),\n",
    "    row=1,\n",
    "    col=2,\n",
    ")\n",
    "\n",
    "# Add grid lines for Jacobian.\n",
    "for i in range(n_rows + 1):\n",
    "    fig.add_shape(\n",
    "        type=\"line\",\n",
    "        x0=-0.5,\n",
    "        x1=n_cols - 0.5,\n",
    "        y0=i - 0.5,\n",
    "        y1=i - 0.5,\n",
    "        line=dict(color=\"#ddd\", width=1),\n",
    "        row=1,\n",
    "        col=2,\n",
    "    )\n",
    "for j in range(n_cols + 1):\n",
    "    fig.add_shape(\n",
    "        type=\"line\",\n",
    "        x0=j - 0.5,\n",
    "        x1=j - 0.5,\n",
    "        y0=-0.5,\n",
    "        y1=n_rows - 0.5,\n",
    "        line=dict(color=\"#ddd\", width=1),\n",
    "        row=1,\n",
    "        col=2,\n",
    "    )\n",
    "\n",
    "# Add block separators (between cost types).\n",
    "type_boundaries = [4, 8]  # After A costs, after B costs\n",
    "for rs in type_boundaries:\n",
    "    fig.add_shape(\n",
    "        type=\"line\",\n",
    "        x0=-0.5,\n",
    "        x1=n_cols - 0.5,\n",
    "        y0=n_rows - rs - 0.5,\n",
    "        y1=n_rows - rs - 0.5,\n",
    "        line=dict(color=\"#999\", width=2),\n",
    "        row=1,\n",
    "        col=2,\n",
    "    )\n",
    "for cs in col_starts[1:]:\n",
    "    fig.add_shape(\n",
    "        type=\"line\",\n",
    "        x0=cs - 0.5,\n",
    "        x1=cs - 0.5,\n",
    "        y0=-0.5,\n",
    "        y1=n_rows - 0.5,\n",
    "        line=dict(color=\"#2196F3\", width=2),\n",
    "        row=1,\n",
    "        col=2,\n",
    "    )\n",
    "\n",
    "# Add column labels (variables) at bottom.\n",
    "col_centers = [col_starts[i] + var_dims[i] / 2 - 0.5 for i in range(len(var_dims))]\n",
    "for i, (cx, label) in enumerate(zip(col_centers, var_labels)):\n",
    "    fig.add_annotation(\n",
    "        x=cx,\n",
    "        y=-1.0,\n",
    "        text=label,\n",
    "        showarrow=False,\n",
    "        font=dict(size=14),\n",
    "        xref=\"x2\",\n",
    "        yref=\"y2\",\n",
    "    )\n",
    "\n",
    "# Add row labels (costs) at left - show type groups.\n",
    "type_labels = [\"A\", \"B\", \"C\"]\n",
    "type_row_ranges = [(0, 4), (4, 8), (8, 10)]\n",
    "for label, (r0, r1) in zip(type_labels, type_row_ranges):\n",
    "    ry = n_rows - (r0 + r1) / 2 - 0.5\n",
    "    fig.add_annotation(\n",
    "        x=-0.8,\n",
    "        y=ry,\n",
    "        text=label,\n",
    "        showarrow=False,\n",
    "        font=dict(size=12),\n",
    "        xref=\"x2\",\n",
    "        yref=\"y2\",\n",
    "    )\n",
    "\n",
    "fig.update_xaxes(showgrid=False, zeroline=False, showticklabels=False, row=1, col=1)\n",
    "fig.update_yaxes(showgrid=False, zeroline=False, showticklabels=False, row=1, col=1)\n",
    "fig.update_xaxes(showgrid=False, zeroline=False, showticklabels=False, row=1, col=2)\n",
    "fig.update_yaxes(showgrid=False, zeroline=False, showticklabels=False, row=1, col=2)\n",
    "\n",
    "fig.update_layout(\n",
    "    height=350,\n",
    "    margin=dict(t=40, b=60, l=60, r=40),\n",
    "    showlegend=False,\n",
    ")\n",
    "\n",
    "HTML(fig.to_html(full_html=False, include_plotlyjs=\"cdn\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-4",
   "metadata": {},
   "source": [
    "I",
    "n",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "e",
    "x",
    "a",
    "m",
    "p",
    "l",
    "e",
    ",",
    " ",
    "t",
    "h",
    "e",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    " ",
    "i",
    "s",
    " ",
    "~",
    "6",
    "0",
    "%",
    " ",
    "z",
    "e",
    "r",
    "o",
    "s",
    ",",
    " ",
    "a",
    "n",
    "d",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "r",
    "a",
    "t",
    "i",
    "o",
    " ",
    "g",
    "r",
    "o",
    "w",
    "s",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    " ",
    "s",
    "i",
    "z",
    "e",
    ".",
    "\n",
    "F",
    "o",
    "r",
    " ",
    "l",
    "a",
    "r",
    "g",
    "e",
    " ",
    "S",
    "L",
    "A",
    "M",
    " ",
    "o",
    "r",
    " ",
    "b",
    "u",
    "n",
    "d",
    "l",
    "e",
    " ",
    "a",
    "d",
    "j",
    "u",
    "s",
    "t",
    "m",
    "e",
    "n",
    "t",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "s",
    ",",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    "s",
    " ",
    "c",
    "a",
    "n",
    " ",
    "b",
    "e",
    " ",
    ">",
    "9",
    "9",
    "%",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    ".",
    " ",
    "E",
    "x",
    "p",
    "l",
    "o",
    "i",
    "t",
    "i",
    "n",
    "g",
    "\n",
    "t",
    "h",
    "i",
    "s",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "i",
    "t",
    "y",
    " ",
    "i",
    "s",
    " ",
    "c",
    "r",
    "i",
    "t",
    "i",
    "c",
    "a",
    "l",
    " ",
    "f",
    "o",
    "r",
    " ",
    "s",
    "c",
    "a",
    "l",
    "i",
    "n",
    "g",
    " ",
    "t",
    "o",
    " ",
    "l",
    "a",
    "r",
    "g",
    "e",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "s",
    "."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-5",
   "metadata": {},
   "source": [
    "#",
    "#",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    "s",
    "\n",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "i",
    "m",
    "p",
    "l",
    "e",
    "m",
    "e",
    "n",
    "t",
    "s",
    " ",
    "t",
    "h",
    "r",
    "e",
    "e",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "r",
    "e",
    "p",
    "r",
    "e",
    "s",
    "e",
    "n",
    "t",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    ".",
    " ",
    "Y",
    "o",
    "u",
    " ",
    "c",
    "a",
    "n",
    " ",
    "s",
    "e",
    "l",
    "e",
    "c",
    "t",
    " ",
    "b",
    "e",
    "t",
    "w",
    "e",
    "e",
    "n",
    " ",
    "t",
    "h",
    "e",
    "m",
    "\n",
    "u",
    "s",
    "i",
    "n",
    "g",
    " ",
    "t",
    "h",
    "e",
    " ",
    "`",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "`",
    " ",
    "p",
    "a",
    "r",
    "a",
    "m",
    "e",
    "t",
    "e",
    "r",
    ":",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "#",
    " ",
    "D",
    "e",
    "f",
    "a",
    "u",
    "l",
    "t",
    ":",
    " ",
    "b",
    "l",
    "o",
    "c",
    "k",
    "-",
    "r",
    "o",
    "w",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    " ",
    "(",
    "b",
    "e",
    "s",
    "t",
    " ",
    "f",
    "o",
    "r",
    " ",
    "C",
    "G",
    " ",
    "o",
    "n",
    " ",
    "G",
    "P",
    "U",
    ")",
    ".",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "=",
    "\"",
    "b",
    "l",
    "o",
    "c",
    "k",
    "r",
    "o",
    "w",
    "\"",
    ")",
    "\n",
    "\n",
    "#",
    " ",
    "C",
    "O",
    "O",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    " ",
    "(",
    "c",
    "o",
    "n",
    "v",
    "e",
    "r",
    "t",
    "s",
    " ",
    "t",
    "o",
    " ",
    "J",
    "A",
    "X",
    " ",
    "B",
    "C",
    "O",
    "O",
    ")",
    ".",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "=",
    "\"",
    "c",
    "o",
    "o",
    "\"",
    ")",
    "\n",
    "\n",
    "#",
    " ",
    "C",
    "S",
    "R",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    " ",
    "(",
    "a",
    "l",
    "w",
    "a",
    "y",
    "s",
    " ",
    "u",
    "s",
    "e",
    "d",
    " ",
    "f",
    "o",
    "r",
    " ",
    "C",
    "H",
    "O",
    "L",
    "M",
    "O",
    "D",
    ")",
    ".",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "=",
    "\"",
    "c",
    "s",
    "r",
    "\"",
    ")",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "#",
    "#",
    "#",
    " ",
    "B",
    "l",
    "o",
    "c",
    "k",
    "R",
    "o",
    "w",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    "\n",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    "'",
    "s",
    " ",
    "d",
    "e",
    "f",
    "a",
    "u",
    "l",
    "t",
    " ",
    "a",
    "n",
    "d",
    " ",
    "r",
    "e",
    "c",
    "o",
    "m",
    "m",
    "e",
    "n",
    "d",
    "e",
    "d",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "r",
    "e",
    "p",
    "r",
    "e",
    "s",
    "e",
    "n",
    "t",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "u",
    "s",
    "e",
    "s",
    " ",
    "w",
    "h",
    "a",
    "t",
    " ",
    "w",
    "e",
    " ",
    "c",
    "a",
    "l",
    "l",
    "\n",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "\"",
    "b",
    "l",
    "o",
    "c",
    "k",
    "-",
    "r",
    "o",
    "w",
    "s",
    "\"",
    ".",
    " ",
    "C",
    "o",
    "s",
    "t",
    "s",
    " ",
    "o",
    "f",
    " ",
    "t",
    "h",
    "e",
    " ",
    "s",
    "a",
    "m",
    "e",
    " ",
    "t",
    "y",
    "p",
    "e",
    " ",
    "h",
    "a",
    "v",
    "e",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    "s",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "i",
    "d",
    "e",
    "n",
    "t",
    "i",
    "c",
    "a",
    "l",
    " ",
    "s",
    "t",
    "r",
    "u",
    "c",
    "t",
    "u",
    "r",
    "e",
    ":",
    "\n",
    "s",
    "a",
    "m",
    "e",
    " ",
    "b",
    "l",
    "o",
    "c",
    "k",
    " ",
    "s",
    "i",
    "z",
    "e",
    "s",
    ",",
    " ",
    "j",
    "u",
    "s",
    "t",
    " ",
    "d",
    "i",
    "f",
    "f",
    "e",
    "r",
    "e",
    "n",
    "t",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    " ",
    "a",
    "n",
    "d",
    " ",
    "c",
    "o",
    "l",
    "u",
    "m",
    "n",
    " ",
    "p",
    "o",
    "s",
    "i",
    "t",
    "i",
    "o",
    "n",
    "s",
    ".",
    " ",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "e",
    "x",
    "p",
    "l",
    "o",
    "i",
    "t",
    "s",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "b",
    "y",
    "\n",
    "b",
    "a",
    "t",
    "c",
    "h",
    "i",
    "n",
    "g",
    " ",
    "b",
    "l",
    "o",
    "c",
    "k",
    "-",
    "r",
    "o",
    "w",
    "s",
    " ",
    "f",
    "r",
    "o",
    "m",
    " ",
    "t",
    "h",
    "e",
    " ",
    "s",
    "a",
    "m",
    "e",
    " ",
    "c",
    "o",
    "s",
    "t",
    " ",
    "t",
    "y",
    "p",
    "e",
    "."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "kayn4eg6v4",
   "metadata": {},
   "source": "Using the same example from above:\n\n$$\nJ = \\left[\\begin{array}{cc|cc|cc}\n\\color{#1976d2}{0.8} & \\color{#1976d2}{0.3} & 0 & 0 & 0 & 0 \\\\\n\\color{#1976d2}{0.1} & \\color{#1976d2}{0.9} & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 & \\color{#1976d2}{0.6} & \\color{#1976d2}{0.2} \\\\\n0 & 0 & 0 & 0 & \\color{#1976d2}{0.4} & \\color{#1976d2}{0.7} \\\\\n\\hline\n\\color{#f57c00}{1.2} & \\color{#f57c00}{0.4} & \\color{#f57c00}{0.7} & \\color{#f57c00}{0.2} & 0 & 0 \\\\\n\\color{#f57c00}{0.5} & \\color{#f57c00}{0.6} & \\color{#f57c00}{0.3} & \\color{#f57c00}{0.8} & 0 & 0 \\\\\n0 & 0 & \\color{#f57c00}{0.9} & \\color{#f57c00}{0.1} & \\color{#f57c00}{0.4} & \\color{#f57c00}{0.7} \\\\\n0 & 0 & \\color{#f57c00}{0.2} & \\color{#f57c00}{0.5} & \\color{#f57c00}{0.8} & \\color{#f57c00}{0.3} \\\\\n\\hline\n\\color{#388e3c}{0.3} & \\color{#388e3c}{0.9} & 0 & 0 & \\color{#388e3c}{0.5} & \\color{#388e3c}{0.1} \\\\\n\\color{#388e3c}{0.7} & \\color{#388e3c}{0.4} & 0 & 0 & \\color{#388e3c}{0.2} & \\color{#388e3c}{0.8}\n\\end{array}\\right]\n\\begin{array}{l}\n\\leftarrow A_0 \\\\\n\\\\\n\\leftarrow A_1 \\\\\n\\\\\n\\leftarrow B_0 \\\\\n\\\\\n\\leftarrow B_1 \\\\\n\\\\\n\\leftarrow C_0 \\\\\n\\end{array}\n$$\n\nEach cost type becomes one `SparseBlockRow`:\n\n```python\n@jdc.pytree_dataclass\nclass BlockRowSparseMatrix:\n    block_rows: tuple[SparseBlockRow, ...]  # One per cost type.\n\n@jdc.pytree_dataclass\nclass SparseBlockRow:\n    num_cols: jdc.Static[int]                      # Total matrix width.\n    block_num_cols: jdc.Static[tuple[int, ...]]    # Block widths.\n    start_cols: tuple[jax.Array, ...]              # Column positions (traced).\n    blocks_concat: jax.Array                       # Jacobian values (traced).\n```\n\n| Cost type | `blocks_concat` shape | `block_num_cols` | `start_cols` | \n|-----------|----------------------|------------------|--------------|\n| A | `(2, 2, 2)` | `(2,)` | `[[0], [4]]` |\n| B | `(2, 2, 4)` | `(2, 2)` | `[[0, 2], [2, 4]]` |\n| C | `(1, 2, 4)` | `(2, 2)` | `[[0, 4]]` |\n\nThe zeros are never stored. `start_cols` records where each block lands in the full matrix.\n\nThe block-row format is more GPU-friendly than traditional sparse formats like COO\nand CSR, which index individual nonzero entries. This leads to irregular\nmemory access patterns and poor cache utilization on GPUs, where performance depends\non coalesced memory access and high arithmetic intensity. The block-row format\nsidesteps these issues:\n\n- **Dense matmul kernels.** Jacobian blocks from each cost type are stacked into\n  dense arrays (`blocks_concat`). Matrix-vector products become batched dense\n  matmuls, which map directly to optimized GPU kernels (cuBLAS, etc.).\n- **Structured indexing.** While `start_cols` involves dynamic indexing for\n  gather/scatter operations, the block structure (number of blocks, their sizes)\n  is static. This is more regular than arbitrary element-wise sparse indexing.\n- **Efficient preconditioning.** Diagonal blocks of $J^T J$ can be accumulated\n  without materializing the full matrix, enabling Block-Jacobi preconditioning\n  with minimal overhead."
  },
  {
   "cell_type": "markdown",
   "id": "x098knls25",
   "metadata": {},
   "source": [
    "#",
    "#",
    "#",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "o",
    "o",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "a",
    "n",
    "d",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "s",
    "r",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    "\n",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "a",
    "l",
    "s",
    "o",
    " ",
    "s",
    "u",
    "p",
    "p",
    "o",
    "r",
    "t",
    "s",
    " ",
    "s",
    "t",
    "a",
    "n",
    "d",
    "a",
    "r",
    "d",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    "s",
    " ",
    "f",
    "o",
    "r",
    " ",
    "c",
    "o",
    "m",
    "p",
    "a",
    "t",
    "i",
    "b",
    "i",
    "l",
    "i",
    "t",
    "y",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "J",
    "A",
    "X",
    "'",
    "s",
    " ",
    "n",
    "a",
    "t",
    "i",
    "v",
    "e",
    "\n",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "o",
    "p",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    " ",
    "a",
    "n",
    "d",
    " ",
    "e",
    "x",
    "t",
    "e",
    "r",
    "n",
    "a",
    "l",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "s",
    " ",
    "l",
    "i",
    "k",
    "e",
    " ",
    "C",
    "H",
    "O",
    "L",
    "M",
    "O",
    "D",
    ".",
    "\n",
    "\n",
    "*",
    "*",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "o",
    "o",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    "*",
    "*",
    " ",
    "(",
    "c",
    "o",
    "o",
    "r",
    "d",
    "i",
    "n",
    "a",
    "t",
    "e",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    ")",
    ":",
    "\n",
    "\n",
    "S",
    "t",
    "o",
    "r",
    "e",
    "s",
    " ",
    "e",
    "a",
    "c",
    "h",
    " ",
    "n",
    "o",
    "n",
    "z",
    "e",
    "r",
    "o",
    " ",
    "a",
    "s",
    " ",
    "a",
    " ",
    "`",
    "(",
    "r",
    "o",
    "w",
    ",",
    " ",
    "c",
    "o",
    "l",
    ",",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    ")",
    "`",
    " ",
    "t",
    "r",
    "i",
    "p",
    "l",
    "e",
    ".",
    " ",
    "S",
    "i",
    "m",
    "p",
    "l",
    "e",
    " ",
    "b",
    "u",
    "t",
    " ",
    "i",
    "n",
    "e",
    "f",
    "f",
    "i",
    "c",
    "i",
    "e",
    "n",
    "t",
    " ",
    "f",
    "o",
    "r",
    "\n",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    " ",
    "o",
    "p",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    " ",
    "s",
    "i",
    "n",
    "c",
    "e",
    " ",
    "e",
    "n",
    "t",
    "r",
    "i",
    "e",
    "s",
    " ",
    "a",
    "r",
    "e",
    "n",
    "'",
    "t",
    " ",
    "o",
    "r",
    "d",
    "e",
    "r",
    "e",
    "d",
    ".",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "@",
    "j",
    "d",
    "c",
    ".",
    "p",
    "y",
    "t",
    "r",
    "e",
    "e",
    "_",
    "d",
    "a",
    "t",
    "a",
    "c",
    "l",
    "a",
    "s",
    "s",
    "\n",
    "c",
    "l",
    "a",
    "s",
    "s",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "o",
    "o",
    "C",
    "o",
    "o",
    "r",
    "d",
    "i",
    "n",
    "a",
    "t",
    "e",
    "s",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "r",
    "o",
    "w",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    "#",
    " ",
    "R",
    "o",
    "w",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "n",
    "z",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "c",
    "o",
    "l",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    "#",
    " ",
    "C",
    "o",
    "l",
    "u",
    "m",
    "n",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "n",
    "z",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    ":",
    " ",
    "t",
    "u",
    "p",
    "l",
    "e",
    "[",
    "i",
    "n",
    "t",
    ",",
    " ",
    "i",
    "n",
    "t",
    "]",
    "\n",
    "\n",
    "@",
    "j",
    "d",
    "c",
    ".",
    "p",
    "y",
    "t",
    "r",
    "e",
    "e",
    "_",
    "d",
    "a",
    "t",
    "a",
    "c",
    "l",
    "a",
    "s",
    "s",
    "\n",
    "c",
    "l",
    "a",
    "s",
    "s",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "o",
    "o",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "#",
    " ",
    "N",
    "o",
    "n",
    "z",
    "e",
    "r",
    "o",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "n",
    "z",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "c",
    "o",
    "o",
    "r",
    "d",
    "s",
    ":",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "o",
    "o",
    "C",
    "o",
    "o",
    "r",
    "d",
    "i",
    "n",
    "a",
    "t",
    "e",
    "s",
    " ",
    " ",
    " ",
    "#",
    " ",
    "R",
    "o",
    "w",
    " ",
    "a",
    "n",
    "d",
    " ",
    "c",
    "o",
    "l",
    "u",
    "m",
    "n",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    ".",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "U",
    "s",
    "e",
    " ",
    "`",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "=",
    "\"",
    "c",
    "o",
    "o",
    "\"",
    "`",
    " ",
    "t",
    "o",
    " ",
    "c",
    "o",
    "n",
    "v",
    "e",
    "r",
    "t",
    " ",
    "t",
    "o",
    " ",
    "J",
    "A",
    "X",
    "'",
    "s",
    " ",
    "n",
    "a",
    "t",
    "i",
    "v",
    "e",
    " ",
    "`",
    "B",
    "C",
    "O",
    "O",
    "`",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    " ",
    "f",
    "o",
    "r",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "\n",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "a",
    "l",
    "g",
    "e",
    "b",
    "r",
    "a",
    " ",
    "o",
    "p",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    ".",
    "\n",
    "\n",
    "*",
    "*",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "s",
    "r",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    "*",
    "*",
    " ",
    "(",
    "c",
    "o",
    "m",
    "p",
    "r",
    "e",
    "s",
    "s",
    "e",
    "d",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "r",
    "o",
    "w",
    ")",
    ":",
    "\n",
    "\n",
    "G",
    "r",
    "o",
    "u",
    "p",
    "s",
    " ",
    "e",
    "n",
    "t",
    "r",
    "i",
    "e",
    "s",
    " ",
    "b",
    "y",
    " ",
    "r",
    "o",
    "w",
    " ",
    "f",
    "o",
    "r",
    " ",
    "e",
    "f",
    "f",
    "i",
    "c",
    "i",
    "e",
    "n",
    "t",
    " ",
    "r",
    "o",
    "w",
    "-",
    "w",
    "i",
    "s",
    "e",
    " ",
    "a",
    "c",
    "c",
    "e",
    "s",
    "s",
    ".",
    " ",
    "E",
    "a",
    "c",
    "h",
    " ",
    "r",
    "o",
    "w",
    "'",
    "s",
    " ",
    "c",
    "o",
    "l",
    "u",
    "m",
    "n",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    "\n",
    "a",
    "n",
    "d",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    " ",
    "a",
    "r",
    "e",
    " ",
    "s",
    "t",
    "o",
    "r",
    "e",
    "d",
    " ",
    "c",
    "o",
    "n",
    "t",
    "i",
    "g",
    "u",
    "o",
    "u",
    "s",
    "l",
    "y",
    ",",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "`",
    "i",
    "n",
    "d",
    "p",
    "t",
    "r",
    "`",
    " ",
    "m",
    "a",
    "r",
    "k",
    "i",
    "n",
    "g",
    " ",
    "w",
    "h",
    "e",
    "r",
    "e",
    " ",
    "e",
    "a",
    "c",
    "h",
    " ",
    "r",
    "o",
    "w",
    " ",
    "s",
    "t",
    "a",
    "r",
    "t",
    "s",
    ".",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "@",
    "j",
    "d",
    "c",
    ".",
    "p",
    "y",
    "t",
    "r",
    "e",
    "e",
    "_",
    "d",
    "a",
    "t",
    "a",
    "c",
    "l",
    "a",
    "s",
    "s",
    " ",
    " ",
    "\n",
    "c",
    "l",
    "a",
    "s",
    "s",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "s",
    "r",
    "C",
    "o",
    "o",
    "r",
    "d",
    "i",
    "n",
    "a",
    "t",
    "e",
    "s",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    "#",
    " ",
    "C",
    "o",
    "l",
    "u",
    "m",
    "n",
    " ",
    "i",
    "n",
    "d",
    "i",
    "c",
    "e",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "n",
    "z",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "i",
    "n",
    "d",
    "p",
    "t",
    "r",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    " ",
    "#",
    " ",
    "R",
    "o",
    "w",
    " ",
    "p",
    "o",
    "i",
    "n",
    "t",
    "e",
    "r",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "r",
    "o",
    "w",
    "s",
    " ",
    "+",
    " ",
    "1",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    ":",
    " ",
    "t",
    "u",
    "p",
    "l",
    "e",
    "[",
    "i",
    "n",
    "t",
    ",",
    " ",
    "i",
    "n",
    "t",
    "]",
    "\n",
    "\n",
    "@",
    "j",
    "d",
    "c",
    ".",
    "p",
    "y",
    "t",
    "r",
    "e",
    "e",
    "_",
    "d",
    "a",
    "t",
    "a",
    "c",
    "l",
    "a",
    "s",
    "s",
    "\n",
    "c",
    "l",
    "a",
    "s",
    "s",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "s",
    "r",
    "M",
    "a",
    "t",
    "r",
    "i",
    "x",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "#",
    " ",
    "N",
    "o",
    "n",
    "z",
    "e",
    "r",
    "o",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    ",",
    " ",
    "s",
    "h",
    "a",
    "p",
    "e",
    " ",
    "(",
    "n",
    "n",
    "z",
    ",",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "c",
    "o",
    "o",
    "r",
    "d",
    "s",
    ":",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    "C",
    "s",
    "r",
    "C",
    "o",
    "o",
    "r",
    "d",
    "i",
    "n",
    "a",
    "t",
    "e",
    "s",
    " ",
    " ",
    " ",
    "#",
    " ",
    "C",
    "S",
    "R",
    " ",
    "i",
    "n",
    "d",
    "e",
    "x",
    " ",
    "s",
    "t",
    "r",
    "u",
    "c",
    "t",
    "u",
    "r",
    "e",
    ".",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "C",
    "S",
    "R",
    " ",
    "i",
    "s",
    " ",
    "r",
    "e",
    "q",
    "u",
    "i",
    "r",
    "e",
    "d",
    " ",
    "f",
    "o",
    "r",
    " ",
    "C",
    "H",
    "O",
    "L",
    "M",
    "O",
    "D",
    " ",
    "(",
    "`",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    "_",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "=",
    "\"",
    "c",
    "h",
    "o",
    "l",
    "m",
    "o",
    "d",
    "\"",
    "`",
    ")",
    ",",
    " ",
    "w",
    "h",
    "i",
    "c",
    "h",
    " ",
    "p",
    "e",
    "r",
    "f",
    "o",
    "r",
    "m",
    "s",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "\n",
    "C",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    " ",
    "f",
    "a",
    "c",
    "t",
    "o",
    "r",
    "i",
    "z",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "o",
    "n",
    " ",
    "C",
    "P",
    "U",
    ".",
    " ",
    "U",
    "s",
    "e",
    " ",
    "`",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    "_",
    "m",
    "o",
    "d",
    "e",
    "=",
    "\"",
    "c",
    "s",
    "r",
    "\"",
    "`",
    " ",
    "t",
    "o",
    " ",
    "b",
    "u",
    "i",
    "l",
    "d",
    " ",
    "t",
    "h",
    "e",
    " ",
    "J",
    "a",
    "c",
    "o",
    "b",
    "i",
    "a",
    "n",
    "\n",
    "i",
    "n",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "f",
    "o",
    "r",
    "m",
    "a",
    "t",
    "."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-7",
   "metadata": {},
   "source": [
    "#",
    "#",
    " ",
    "L",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "s",
    "\n",
    "\n",
    "T",
    "h",
    "e",
    " ",
    "G",
    "a",
    "u",
    "s",
    "s",
    "-",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "u",
    "p",
    "d",
    "a",
    "t",
    "e",
    " ",
    "r",
    "e",
    "q",
    "u",
    "i",
    "r",
    "e",
    "s",
    " ",
    "s",
    "o",
    "l",
    "v",
    "i",
    "n",
    "g",
    " ",
    "$",
    "(",
    "J",
    "^",
    "T",
    " ",
    "J",
    " ",
    "+",
    " ",
    "\\",
    "l",
    "a",
    "m",
    "b",
    "d",
    "a",
    " ",
    "I",
    ")",
    " ",
    "\\",
    "D",
    "e",
    "l",
    "t",
    "a",
    " ",
    "x",
    " ",
    "=",
    " ",
    "-",
    "J",
    "^",
    "T",
    " ",
    "r",
    "$",
    ".",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "o",
    "f",
    "f",
    "e",
    "r",
    "s",
    " ",
    "t",
    "h",
    "r",
    "e",
    "e",
    " ",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "s",
    " ",
    "f",
    "o",
    "r",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "s",
    "y",
    "s",
    "t",
    "e",
    "m",
    ":",
    "\n",
    "\n",
    "#",
    "#",
    "#",
    " ",
    "C",
    "o",
    "n",
    "j",
    "u",
    "g",
    "a",
    "t",
    "e",
    " ",
    "g",
    "r",
    "a",
    "d",
    "i",
    "e",
    "n",
    "t",
    " ",
    "(",
    "d",
    "e",
    "f",
    "a",
    "u",
    "l",
    "t",
    ")",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    "_",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "=",
    "\"",
    "c",
    "o",
    "n",
    "j",
    "u",
    "g",
    "a",
    "t",
    "e",
    "_",
    "g",
    "r",
    "a",
    "d",
    "i",
    "e",
    "n",
    "t",
    "\"",
    ")",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "T",
    "h",
    "i",
    "s",
    " ",
    "i",
    "s",
    " ",
    "t",
    "h",
    "e",
    " ",
    "d",
    "e",
    "f",
    "a",
    "u",
    "l",
    "t",
    " ",
    "a",
    "n",
    "d",
    " ",
    "g",
    "e",
    "n",
    "e",
    "r",
    "a",
    "l",
    "l",
    "y",
    " ",
    "r",
    "e",
    "c",
    "o",
    "m",
    "m",
    "e",
    "n",
    "d",
    "e",
    "d",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    ".",
    "\n",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "B",
    "e",
    "s",
    "t",
    " ",
    "f",
    "o",
    "r",
    "*",
    "*",
    ":",
    " ",
    "L",
    "a",
    "r",
    "g",
    "e",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "s",
    ",",
    " ",
    "G",
    "P",
    "U",
    " ",
    "a",
    "c",
    "c",
    "e",
    "l",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "P",
    "r",
    "o",
    "s",
    "*",
    "*",
    ":",
    " ",
    "M",
    "e",
    "m",
    "o",
    "r",
    "y",
    "-",
    "e",
    "f",
    "f",
    "i",
    "c",
    "i",
    "e",
    "n",
    "t",
    " ",
    "(",
    "n",
    "e",
    "v",
    "e",
    "r",
    " ",
    "f",
    "o",
    "r",
    "m",
    "s",
    " ",
    "$",
    "J",
    "^",
    "T",
    " ",
    "J",
    "$",
    ")",
    ",",
    " ",
    "J",
    "A",
    "X",
    "-",
    "n",
    "a",
    "t",
    "i",
    "v",
    "e",
    ",",
    " ",
    "w",
    "o",
    "r",
    "k",
    "s",
    " ",
    "o",
    "n",
    " ",
    "G",
    "P",
    "U",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "C",
    "o",
    "n",
    "s",
    "*",
    "*",
    ":",
    " ",
    "M",
    "a",
    "y",
    " ",
    "r",
    "e",
    "q",
    "u",
    "i",
    "r",
    "e",
    " ",
    "m",
    "a",
    "n",
    "y",
    " ",
    "i",
    "t",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    ",",
    " ",
    "s",
    "e",
    "n",
    "s",
    "i",
    "t",
    "i",
    "v",
    "e",
    " ",
    "t",
    "o",
    " ",
    "c",
    "o",
    "n",
    "d",
    "i",
    "t",
    "i",
    "o",
    "n",
    "i",
    "n",
    "g",
    "\n",
    "\n",
    "U",
    "s",
    "e",
    "s",
    " ",
    "i",
    "n",
    "e",
    "x",
    "a",
    "c",
    "t",
    " ",
    "N",
    "e",
    "w",
    "t",
    "o",
    "n",
    " ",
    "v",
    "i",
    "a",
    " ",
    "[",
    "E",
    "i",
    "s",
    "e",
    "n",
    "s",
    "t",
    "a",
    "t",
    "-",
    "W",
    "a",
    "l",
    "k",
    "e",
    "r",
    "]",
    "(",
    "h",
    "t",
    "t",
    "p",
    "s",
    ":",
    "/",
    "/",
    "d",
    "o",
    "i",
    ".",
    "o",
    "r",
    "g",
    "/",
    "1",
    "0",
    ".",
    "1",
    "1",
    "3",
    "7",
    "/",
    "0",
    "9",
    "1",
    "7",
    "0",
    "0",
    "3",
    ")",
    " ",
    "a",
    "d",
    "a",
    "p",
    "t",
    "i",
    "v",
    "e",
    " ",
    "t",
    "o",
    "l",
    "e",
    "r",
    "a",
    "n",
    "c",
    "e",
    "s",
    ".",
    "\n",
    "\n",
    "#",
    "#",
    "#",
    " ",
    "D",
    "e",
    "n",
    "s",
    "e",
    " ",
    "C",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    "_",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "=",
    "\"",
    "d",
    "e",
    "n",
    "s",
    "e",
    "_",
    "c",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    "\"",
    ")",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "B",
    "e",
    "s",
    "t",
    " ",
    "f",
    "o",
    "r",
    "*",
    "*",
    ":",
    " ",
    "S",
    "m",
    "a",
    "l",
    "l",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "s",
    " ",
    "(",
    "<",
    "1",
    "0",
    "0",
    "0",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "b",
    "l",
    "e",
    "s",
    ")",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "P",
    "r",
    "o",
    "s",
    "*",
    "*",
    ":",
    " ",
    "D",
    "i",
    "r",
    "e",
    "c",
    "t",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    ",",
    " ",
    "n",
    "o",
    " ",
    "i",
    "t",
    "e",
    "r",
    "a",
    "t",
    "i",
    "o",
    "n",
    "s",
    ",",
    " ",
    "n",
    "u",
    "m",
    "e",
    "r",
    "i",
    "c",
    "a",
    "l",
    "l",
    "y",
    " ",
    "s",
    "t",
    "a",
    "b",
    "l",
    "e",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "C",
    "o",
    "n",
    "s",
    "*",
    "*",
    ":",
    " ",
    "F",
    "o",
    "r",
    "m",
    "s",
    " ",
    "d",
    "e",
    "n",
    "s",
    "e",
    " ",
    "$",
    "J",
    "^",
    "T",
    " ",
    "J",
    "$",
    " ",
    "m",
    "a",
    "t",
    "r",
    "i",
    "x",
    ",",
    " ",
    "$",
    "O",
    "(",
    "n",
    "^",
    "3",
    ")",
    "$",
    " ",
    "c",
    "o",
    "m",
    "p",
    "l",
    "e",
    "x",
    "i",
    "t",
    "y",
    "\n",
    "\n",
    "#",
    "#",
    "#",
    " ",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "C",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    " ",
    "(",
    "C",
    "H",
    "O",
    "L",
    "M",
    "O",
    "D",
    ")",
    "\n",
    "\n",
    "`",
    "`",
    "`",
    "p",
    "y",
    "t",
    "h",
    "o",
    "n",
    "\n",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    "_",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "=",
    "\"",
    "c",
    "h",
    "o",
    "l",
    "m",
    "o",
    "d",
    "\"",
    ")",
    "\n",
    "`",
    "`",
    "`",
    "\n",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "B",
    "e",
    "s",
    "t",
    " ",
    "f",
    "o",
    "r",
    "*",
    "*",
    ":",
    " ",
    "L",
    "a",
    "r",
    "g",
    "e",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "s",
    " ",
    "o",
    "n",
    " ",
    "C",
    "P",
    "U",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "P",
    "r",
    "o",
    "s",
    "*",
    "*",
    ":",
    " ",
    "D",
    "i",
    "r",
    "e",
    "c",
    "t",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    ",",
    " ",
    "e",
    "x",
    "p",
    "l",
    "o",
    "i",
    "t",
    "s",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "i",
    "t",
    "y",
    ",",
    " ",
    "s",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "f",
    "i",
    "l",
    "l",
    "-",
    "r",
    "e",
    "d",
    "u",
    "c",
    "i",
    "n",
    "g",
    " ",
    "o",
    "r",
    "d",
    "e",
    "r",
    "i",
    "n",
    "g",
    "\n",
    "-",
    " ",
    "*",
    "*",
    "C",
    "o",
    "n",
    "s",
    "*",
    "*",
    ":",
    " ",
    "C",
    "P",
    "U",
    " ",
    "o",
    "n",
    "l",
    "y",
    ",",
    " ",
    "r",
    "e",
    "q",
    "u",
    "i",
    "r",
    "e",
    "s",
    " ",
    "S",
    "u",
    "i",
    "t",
    "e",
    "S",
    "p",
    "a",
    "r",
    "s",
    "e",
    " ",
    "i",
    "n",
    "s",
    "t",
    "a",
    "l",
    "l",
    "a",
    "t",
    "i",
    "o",
    "n",
    "\n",
    "\n",
    "j",
    "a",
    "x",
    "l",
    "s",
    " ",
    "c",
    "a",
    "c",
    "h",
    "e",
    "s",
    " ",
    "t",
    "h",
    "e",
    " ",
    "s",
    "y",
    "m",
    "b",
    "o",
    "l",
    "i",
    "c",
    " ",
    "f",
    "a",
    "c",
    "t",
    "o",
    "r",
    "i",
    "z",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "(",
    "s",
    "p",
    "a",
    "r",
    "s",
    "i",
    "t",
    "y",
    " ",
    "p",
    "a",
    "t",
    "t",
    "e",
    "r",
    "n",
    " ",
    "a",
    "n",
    "a",
    "l",
    "y",
    "s",
    "i",
    "s",
    ")",
    ",",
    " ",
    "s",
    "o",
    " ",
    "r",
    "e",
    "p",
    "e",
    "a",
    "t",
    "e",
    "d",
    "\n",
    "s",
    "o",
    "l",
    "v",
    "e",
    "s",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "t",
    "h",
    "e",
    " ",
    "s",
    "a",
    "m",
    "e",
    " ",
    "s",
    "t",
    "r",
    "u",
    "c",
    "t",
    "u",
    "r",
    "e",
    " ",
    "a",
    "r",
    "e",
    " ",
    "f",
    "a",
    "s",
    "t",
    "."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-8",
   "metadata": {},
   "source": "## Preconditioning\n\nFor conjugate gradient, preconditioning accelerates convergence by transforming\nthe linear system. Instead of solving $Ax = b$ directly, we solve\n$M^{-1}Ax = M^{-1}b$ where the preconditioner $M \\approx A$ is easy to invert.\n\nFor the normal equations $A = J^T J$, jaxls provides two preconditioners:\n\n### Block Jacobi (default)\n\n```python\nsolution = problem.solve(\n    linear_solver=\"conjugate_gradient\",\n    conjugate_gradient=jaxls.ConjugateGradientConfig(\n        preconditioner=\"block_jacobi\",\n    ),\n)\n```\n\nUses $M = \\text{blockdiag}(J^T J)$, where blocks correspond to individual variables.\nFor variable $i$ with Jacobian columns $J_i$:\n\n$$M_i = J_i^T J_i$$\n\nEffective when off-diagonal coupling between variables is weak.\n\n### Point Jacobi\n\n```python\nsolution = problem.solve(\n    linear_solver=\"conjugate_gradient\",\n    conjugate_gradient=jaxls.ConjugateGradientConfig(\n        preconditioner=\"point_jacobi\",\n    ),\n)\n```\n\nUses $M = \\text{diag}(J^T J)$, a scalar per tangent dimension:\n\n$$M_{ii} = \\sum_j J_{ji}^2$$\n\nCheaper to compute but less effective than block Jacobi.\n\n## Related pages\n\n- {doc}`../guide/tips_and_gotchas`: Practical guidance on solver and Jacobian mode selection\n- {doc}`../guide/advanced/custom_jacobians`: Providing analytical Jacobians\n- {doc}`traced_vs_static`: What values are traced vs static in JAX compilation"
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "name": "python",
   "version": "3.12.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}