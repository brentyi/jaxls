{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "cell-0",
   "metadata": {},
   "source": "# Mean-Variance Allocation\n\nFinding optimal asset allocations that balance risk and return, following the\n[Markowitz mean-variance framework](https://en.wikipedia.org/wiki/Modern_portfolio_theory).\n\nThis example is adapted from the [JuMP portfolio optimization tutorial](https://jump.dev/JuMP.jl/stable/tutorials/nonlinear/portfolio/).\n\nFeatures used:\n- {class}`~jaxls.Var` with vector-valued default\n- Equality constraints (`constraint_eq_zero`): budget constraint\n- Inequality constraints (`constraint_geq_zero`): minimum return, no short-selling\n- Augmented Lagrangian solver for constrained optimization\n- Efficient frontier via parametric sweeps"
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "cell-1",
   "metadata": {
    "tags": [
     "hide-cell",
     "hide-input"
    ]
   },
   "outputs": [],
   "source": [
    "import sys\n",
    "from loguru import logger\n",
    "\n",
    "logger.remove()\n",
    "logger.add(sys.stdout, format=\"<level>{level: <8}</level> | {message}\");"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "cell-2",
   "metadata": {},
   "outputs": [],
   "source": [
    "import jax\n",
    "import jax.numpy as jnp\n",
    "import jaxls"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-3",
   "metadata": {},
   "source": [
    "## Historical stock data\n",
    "\n",
    "Monthly stock prices from November 2000 to November 2001 for three stocks:\n",
    "IBM, Walmart (WMT), and Southern Electric (SEHI)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "cell-4",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Price data shape: (13, 3) (months \u00d7 stocks)\n"
     ]
    }
   ],
   "source": [
    "stock_names = [\"IBM\", \"WMT\", \"SEHI\"]\n",
    "\n",
    "# Monthly prices (13 months: Nov 2000 - Nov 2001)\n",
    "prices = jnp.array(\n",
    "    [\n",
    "        [93.043, 51.826, 1.063],\n",
    "        [84.585, 52.823, 0.938],\n",
    "        [111.453, 56.477, 1.0],\n",
    "        [99.525, 49.805, 0.938],\n",
    "        [95.819, 50.287, 1.438],\n",
    "        [114.708, 51.521, 1.7],\n",
    "        [111.515, 51.531, 2.54],\n",
    "        [113.211, 48.664, 2.39],\n",
    "        [104.942, 55.744, 3.12],\n",
    "        [99.827, 47.916, 2.98],\n",
    "        [91.607, 49.438, 1.9],\n",
    "        [107.937, 51.336, 1.75],\n",
    "        [115.59, 55.081, 1.8],\n",
    "    ]\n",
    ")\n",
    "\n",
    "print(f\"Price data shape: {prices.shape} (months \u00d7 stocks)\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "44i17f81qkp",
   "metadata": {
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>                        <script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>\n",
       "        <script charset=\"utf-8\" src=\"https://cdn.plot.ly/plotly-3.1.0.min.js\" integrity=\"sha256-Ei4740bWZhaUTQuD6q9yQlgVCMPBz6CZWhevDYPv93A=\" crossorigin=\"anonymous\"></script>                <div id=\"39658256-e542-4dc9-ab8c-a756dde3b1d1\" class=\"plotly-graph-div\" style=\"height:350px; width:100%;\"></div>            <script type=\"text/javascript\">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById(\"39658256-e542-4dc9-ab8c-a756dde3b1d1\")) {                    Plotly.newPlot(                        \"39658256-e542-4dc9-ab8c-a756dde3b1d1\",                        [{\"line\":{\"color\":\"#2196F3\",\"width\":2},\"marker\":{\"size\":6},\"mode\":\"lines+markers\",\"name\":\"IBM\",\"x\":[\"Nov '00\",\"Dec '00\",\"Jan '01\",\"Feb '01\",\"Mar '01\",\"Apr '01\",\"May '01\",\"Jun '01\",\"Jul '01\",\"Aug '01\",\"Sep '01\",\"Oct '01\",\"Nov '01\"],\"y\":{\"dtype\":\"f4\",\"bdata\":\"BBa6QoUrqULw595CzQzHQlSjv0J\\u002fauVCrgffQghs4kJO4tFCbafHQsk2t0K+39dCFC7nQg==\"},\"type\":\"scatter\"},{\"line\":{\"color\":\"#4CAF50\",\"width\":2},\"marker\":{\"size\":6},\"mode\":\"lines+markers\",\"name\":\"WMT\",\"x\":[\"Nov '00\",\"Dec '00\",\"Jan '01\",\"Feb '01\",\"Mar '01\",\"Apr '01\",\"May '01\",\"Jun '01\",\"Jul '01\",\"Aug '01\",\"Sep '01\",\"Oct '01\",\"Nov '01\"],\"y\":{\"dtype\":\"f4\",\"bdata\":\"001PQsFKU0Jz6GFCUjhHQuMlSUKBFU5Cvh9OQvCnQkLb+V5C\\u002fKk\\u002fQoPARUIQWE1C8lJcQg==\"},\"type\":\"scatter\"},{\"line\":{\"color\":\"#FF9800\",\"width\":2},\"marker\":{\"size\":6},\"mode\":\"lines+markers\",\"name\":\"SEHI\",\"x\":[\"Nov '00\",\"Dec '00\",\"Jan '01\",\"Feb '01\",\"Mar '01\",\"Apr '01\",\"May '01\",\"Jun '01\",\"Jul '01\",\"Aug '01\",\"Sep '01\",\"Oct '01\",\"Nov '01\"],\"y\":{\"dtype\":\"f4\",\"bdata\":\"YhCIP8UgcD8AAIA\\u002fxSBwP2IQuD+amdk\\u002fXI8iQMP1GEAUrkdAUrg+QDMz8z8AAOA\\u002fZmbmPw==\"},\"type\":\"scatter\"}],                        {\"template\":{\"data\":{\"histogram2dcontour\":[{\"type\":\"histogram2dcontour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"choropleth\":[{\"type\":\"choropleth\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"histogram2d\":[{\"type\":\"histogram2d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmap\":[{\"type\":\"heatmap\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"contourcarpet\":[{\"type\":\"contourcarpet\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"contour\":[{\"type\":\"contour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"surface\":[{\"type\":\"surface\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"mesh3d\":[{\"type\":\"mesh3d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"scatter\":[{\"fillpattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2},\"type\":\"scatter\"}],\"parcoords\":[{\"type\":\"parcoords\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolargl\":[{\"type\":\"scatterpolargl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"bar\":[{\"error_x\":{\"color\":\"#2a3f5f\"},\"error_y\":{\"color\":\"#2a3f5f\"},\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"scattergeo\":[{\"type\":\"scattergeo\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolar\":[{\"type\":\"scatterpolar\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"scattergl\":[{\"type\":\"scattergl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatter3d\":[{\"type\":\"scatter3d\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermap\":[{\"type\":\"scattermap\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermapbox\":[{\"type\":\"scattermapbox\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterternary\":[{\"type\":\"scatterternary\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattercarpet\":[{\"type\":\"scattercarpet\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"baxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"type\":\"carpet\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#EBF0F8\"},\"line\":{\"color\":\"white\"}},\"header\":{\"fill\":{\"color\":\"#C8D4E3\"},\"line\":{\"color\":\"white\"}},\"type\":\"table\"}],\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}]},\"layout\":{\"autotypenumbers\":\"strict\",\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#2a3f5f\"},\"hovermode\":\"closest\",\"hoverlabel\":{\"align\":\"left\"},\"paper_bgcolor\":\"white\",\"plot_bgcolor\":\"#E5ECF6\",\"polar\":{\"bgcolor\":\"#E5ECF6\",\"angularaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"radialaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"ternary\":{\"bgcolor\":\"#E5ECF6\",\"aaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"caxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]]},\"xaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"yaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"yaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"zaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2}},\"shapedefaults\":{\"line\":{\"color\":\"#2a3f5f\"}},\"annotationdefaults\":{\"arrowcolor\":\"#2a3f5f\",\"arrowhead\":0,\"arrowwidth\":1},\"geo\":{\"bgcolor\":\"white\",\"landcolor\":\"#E5ECF6\",\"subunitcolor\":\"white\",\"showland\":true,\"showlakes\":true,\"lakecolor\":\"white\"},\"title\":{\"x\":0.05},\"mapbox\":{\"style\":\"light\"}}},\"margin\":{\"t\":40,\"b\":40,\"l\":60,\"r\":40},\"legend\":{\"orientation\":\"h\",\"yanchor\":\"bottom\",\"y\":1.02,\"xanchor\":\"center\",\"x\":0.5},\"title\":{\"text\":\"Historical Stock Prices\"},\"xaxis\":{\"title\":{\"text\":\"Month\"}},\"yaxis\":{\"title\":{\"text\":\"Price ($)\"}},\"height\":350,\"hovermode\":\"x unified\"},                        {\"responsive\": true}                    )                };            </script>        </div>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import plotly.graph_objects as go\n",
    "from IPython.display import HTML\n",
    "\n",
    "# Create date range for x-axis (Nov 2000 - Nov 2001)\n",
    "months = [\n",
    "    \"Nov '00\",\n",
    "    \"Dec '00\",\n",
    "    \"Jan '01\",\n",
    "    \"Feb '01\",\n",
    "    \"Mar '01\",\n",
    "    \"Apr '01\",\n",
    "    \"May '01\",\n",
    "    \"Jun '01\",\n",
    "    \"Jul '01\",\n",
    "    \"Aug '01\",\n",
    "    \"Sep '01\",\n",
    "    \"Oct '01\",\n",
    "    \"Nov '01\",\n",
    "]\n",
    "\n",
    "colors = [\"#2196F3\", \"#4CAF50\", \"#FF9800\"]\n",
    "\n",
    "fig = go.Figure()\n",
    "for i, (name, color) in enumerate(zip(stock_names, colors)):\n",
    "    fig.add_trace(\n",
    "        go.Scatter(\n",
    "            x=months,\n",
    "            y=prices[:, i],\n",
    "            mode=\"lines+markers\",\n",
    "            name=name,\n",
    "            line=dict(color=color, width=2),\n",
    "            marker=dict(size=6),\n",
    "        )\n",
    "    )\n",
    "\n",
    "fig.update_layout(\n",
    "    title=\"Historical Stock Prices\",\n",
    "    xaxis_title=\"Month\",\n",
    "    yaxis_title=\"Price ($)\",\n",
    "    height=350,\n",
    "    margin=dict(t=40, b=40, l=60, r=40),\n",
    "    legend=dict(orientation=\"h\", yanchor=\"bottom\", y=1.02, xanchor=\"center\", x=0.5),\n",
    "    hovermode=\"x unified\",\n",
    ")\n",
    "HTML(fig.to_html(full_html=False, include_plotlyjs=\"cdn\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-5",
   "metadata": {},
   "source": [
    "## Computing returns and covariance\n",
    "\n",
    "Monthly returns are computed as percentage changes, then we estimate\n",
    "expected returns and the covariance matrix."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "cell-6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Expected monthly returns:\n",
      "  IBM: +2.60%\n",
      "  WMT: +0.81%\n",
      "  SEHI: +7.37%\n",
      "\n",
      "Covariance matrix:\n",
      "[[0.01864104 0.00359853 0.00130976]\n",
      " [0.00359853 0.00643694 0.00488726]\n",
      " [0.00130976 0.00488726 0.06868275]]\n"
     ]
    }
   ],
   "source": [
    "# Monthly returns: (P[t+1] - P[t]) / P[t]\n",
    "returns = jnp.diff(prices, axis=0) / prices[:-1]\n",
    "\n",
    "# Expected return (mean of monthly returns)\n",
    "expected_returns = jnp.mean(returns, axis=0)\n",
    "\n",
    "# Covariance matrix (sample covariance)\n",
    "returns_centered = returns - expected_returns\n",
    "covariance = (returns_centered.T @ returns_centered) / (returns.shape[0] - 1)\n",
    "\n",
    "print(\"Expected monthly returns:\")\n",
    "for name, r in zip(stock_names, expected_returns):\n",
    "    print(f\"  {name}: {float(r) * 100:+.2f}%\")\n",
    "print(f\"\\nCovariance matrix:\\n{covariance}\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-7",
   "metadata": {},
   "source": [
    "## Problem formulation\n",
    "\n",
    "We want to invest $1000 to minimize portfolio variance while achieving a\n",
    "target return.\n",
    "\n",
    "Constraints:\n",
    "- Budget: total investment = $1000 (weights sum to 1)\n",
    "- Minimum return: expected return $\\geq$ target\n",
    "- No short-selling: all investments $\\geq$ 0"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "cell-8",
   "metadata": {},
   "outputs": [],
   "source": [
    "class WeightsVar(jaxls.Var[jax.Array], default_factory=lambda: jnp.ones(3) / 3):\n",
    "    \"\"\"Portfolio weights (3D vector).\"\"\"\n",
    "\n",
    "\n",
    "weights_var = WeightsVar(id=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "cell-9",
   "metadata": {},
   "outputs": [],
   "source": [
    "@jaxls.Cost.factory\n",
    "def variance_cost(\n",
    "    vals: jaxls.VarValues, var: WeightsVar, cov_chol: jax.Array\n",
    ") -> jax.Array:\n",
    "    \"\"\"Minimize portfolio variance: ||L.T @ w||^2 = w.T @ cov @ w.\"\"\"\n",
    "    return cov_chol.T @ vals[var]\n",
    "\n",
    "\n",
    "@jaxls.Cost.factory(kind=\"constraint_eq_zero\")\n",
    "def budget_constraint(vals: jaxls.VarValues, var: WeightsVar) -> jax.Array:\n",
    "    \"\"\"Weights must sum to 1 (fully invested).\"\"\"\n",
    "    return jnp.sum(vals[var]) - 1.0\n",
    "\n",
    "\n",
    "@jaxls.Cost.factory(kind=\"constraint_geq_zero\")\n",
    "def return_constraint(\n",
    "    vals: jaxls.VarValues, var: WeightsVar, exp_ret: jax.Array, target: float\n",
    ") -> jax.Array:\n",
    "    \"\"\"Expected return must meet target: E[r] >= target.\"\"\"\n",
    "    return jnp.array([jnp.dot(vals[var], exp_ret) - target])\n",
    "\n",
    "\n",
    "@jaxls.Cost.factory(kind=\"constraint_geq_zero\")\n",
    "def no_short_constraint(vals: jaxls.VarValues, var: WeightsVar) -> jax.Array:\n",
    "    \"\"\"No short-selling: weights >= 0.\"\"\"\n",
    "    return vals[var]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-10",
   "metadata": {},
   "source": "## Efficient frontier\n\nThe efficient frontier shows the optimal trade-off between risk (variance)\nand return. We compute it by solving the optimization problem for different\ntarget returns.\n\nUsing `jax.lax.scan`, we solve sequentially while using each solution as the\ninitial guess for the next (warm-starting). This helps convergence since\nadjacent target returns have similar optimal allocations."
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "cell-11",
   "metadata": {},
   "outputs": [],
   "source": [
    "#",
    " ",
    "C",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    " ",
    "d",
    "e",
    "c",
    "o",
    "m",
    "p",
    "o",
    "s",
    "i",
    "t",
    "i",
    "o",
    "n",
    " ",
    "f",
    "o",
    "r",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "n",
    "c",
    "e",
    " ",
    "c",
    "o",
    "s",
    "t",
    "\n",
    "c",
    "o",
    "v",
    "_",
    "c",
    "h",
    "o",
    "l",
    " ",
    "=",
    " ",
    "j",
    "n",
    "p",
    ".",
    "l",
    "i",
    "n",
    "a",
    "l",
    "g",
    ".",
    "c",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    "(",
    "c",
    "o",
    "v",
    "a",
    "r",
    "i",
    "a",
    "n",
    "c",
    "e",
    ")",
    "\n",
    "\n",
    "#",
    " ",
    "R",
    "a",
    "n",
    "g",
    "e",
    " ",
    "o",
    "f",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    " ",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    " ",
    "t",
    "o",
    " ",
    "e",
    "x",
    "p",
    "l",
    "o",
    "r",
    "e",
    "\n",
    "m",
    "i",
    "n",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    " ",
    "=",
    " ",
    "f",
    "l",
    "o",
    "a",
    "t",
    "(",
    "e",
    "x",
    "p",
    "e",
    "c",
    "t",
    "e",
    "d",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ".",
    "m",
    "i",
    "n",
    "(",
    ")",
    ")",
    "\n",
    "m",
    "a",
    "x",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    " ",
    "=",
    " ",
    "f",
    "l",
    "o",
    "a",
    "t",
    "(",
    "e",
    "x",
    "p",
    "e",
    "c",
    "t",
    "e",
    "d",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ".",
    "m",
    "a",
    "x",
    "(",
    ")",
    ")",
    "\n",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    " ",
    "=",
    " ",
    "j",
    "n",
    "p",
    ".",
    "l",
    "i",
    "n",
    "s",
    "p",
    "a",
    "c",
    "e",
    "(",
    "m",
    "i",
    "n",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    ",",
    " ",
    "m",
    "a",
    "x",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    ",",
    " ",
    "5",
    "0",
    ")",
    "\n",
    "\n",
    "\n",
    "d",
    "e",
    "f",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "_",
    "f",
    "o",
    "r",
    "_",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    "(",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "c",
    "u",
    "r",
    "r",
    "e",
    "n",
    "t",
    "_",
    "v",
    "a",
    "l",
    "s",
    ":",
    " ",
    "j",
    "a",
    "x",
    "l",
    "s",
    ".",
    "V",
    "a",
    "r",
    "V",
    "a",
    "l",
    "u",
    "e",
    "s",
    ",",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    ":",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    "\n",
    ")",
    " ",
    "-",
    ">",
    " ",
    "t",
    "u",
    "p",
    "l",
    "e",
    "[",
    "j",
    "a",
    "x",
    "l",
    "s",
    ".",
    "V",
    "a",
    "r",
    "V",
    "a",
    "l",
    "u",
    "e",
    "s",
    ",",
    " ",
    "j",
    "a",
    "x",
    ".",
    "A",
    "r",
    "r",
    "a",
    "y",
    "]",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "\"",
    "\"",
    "\"",
    "S",
    "o",
    "l",
    "v",
    "e",
    " ",
    "p",
    "o",
    "r",
    "t",
    "f",
    "o",
    "l",
    "i",
    "o",
    " ",
    "o",
    "p",
    "t",
    "i",
    "m",
    "i",
    "z",
    "a",
    "t",
    "i",
    "o",
    "n",
    " ",
    "f",
    "o",
    "r",
    " ",
    "a",
    " ",
    "g",
    "i",
    "v",
    "e",
    "n",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    " ",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    ".",
    "\n",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "A",
    "r",
    "g",
    "s",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "c",
    "u",
    "r",
    "r",
    "e",
    "n",
    "t",
    "_",
    "v",
    "a",
    "l",
    "s",
    ":",
    " ",
    "S",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "f",
    "r",
    "o",
    "m",
    " ",
    "p",
    "r",
    "e",
    "v",
    "i",
    "o",
    "u",
    "s",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    " ",
    "(",
    "u",
    "s",
    "e",
    "d",
    " ",
    "a",
    "s",
    " ",
    "i",
    "n",
    "i",
    "t",
    "i",
    "a",
    "l",
    " ",
    "g",
    "u",
    "e",
    "s",
    "s",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    ":",
    " ",
    "T",
    "a",
    "r",
    "g",
    "e",
    "t",
    " ",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    " ",
    "f",
    "o",
    "r",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    ".",
    "\n",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "R",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ":",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "T",
    "u",
    "p",
    "l",
    "e",
    " ",
    "o",
    "f",
    " ",
    "(",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "v",
    "a",
    "l",
    "u",
    "e",
    "s",
    ",",
    " ",
    "o",
    "p",
    "t",
    "i",
    "m",
    "a",
    "l",
    " ",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    ")",
    ".",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "\"",
    "\"",
    "\"",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "c",
    "o",
    "s",
    "t",
    "s",
    " ",
    "=",
    " ",
    "[",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "v",
    "a",
    "r",
    "i",
    "a",
    "n",
    "c",
    "e",
    "_",
    "c",
    "o",
    "s",
    "t",
    "(",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    ",",
    " ",
    "c",
    "o",
    "v",
    "_",
    "c",
    "h",
    "o",
    "l",
    ")",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "b",
    "u",
    "d",
    "g",
    "e",
    "t",
    "_",
    "c",
    "o",
    "n",
    "s",
    "t",
    "r",
    "a",
    "i",
    "n",
    "t",
    "(",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    ")",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "_",
    "c",
    "o",
    "n",
    "s",
    "t",
    "r",
    "a",
    "i",
    "n",
    "t",
    "(",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    ",",
    " ",
    "e",
    "x",
    "p",
    "e",
    "c",
    "t",
    "e",
    "d",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ",",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    ")",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "n",
    "o",
    "_",
    "s",
    "h",
    "o",
    "r",
    "t",
    "_",
    "c",
    "o",
    "n",
    "s",
    "t",
    "r",
    "a",
    "i",
    "n",
    "t",
    "(",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    ")",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "]",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    " ",
    "=",
    " ",
    "j",
    "a",
    "x",
    "l",
    "s",
    ".",
    "L",
    "e",
    "a",
    "s",
    "t",
    "S",
    "q",
    "u",
    "a",
    "r",
    "e",
    "s",
    "P",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "(",
    "c",
    "o",
    "s",
    "t",
    "s",
    ",",
    " ",
    "[",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    "]",
    ")",
    ".",
    "a",
    "n",
    "a",
    "l",
    "y",
    "z",
    "e",
    "(",
    ")",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "#",
    " ",
    "U",
    "s",
    "e",
    " ",
    "d",
    "e",
    "n",
    "s",
    "e",
    " ",
    "C",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    " ",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    " ",
    "f",
    "o",
    "r",
    " ",
    "t",
    "h",
    "i",
    "s",
    " ",
    "s",
    "m",
    "a",
    "l",
    "l",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    " ",
    "=",
    " ",
    "p",
    "r",
    "o",
    "b",
    "l",
    "e",
    "m",
    ".",
    "s",
    "o",
    "l",
    "v",
    "e",
    "(",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "c",
    "u",
    "r",
    "r",
    "e",
    "n",
    "t",
    "_",
    "v",
    "a",
    "l",
    "s",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "v",
    "e",
    "r",
    "b",
    "o",
    "s",
    "e",
    "=",
    "F",
    "a",
    "l",
    "s",
    "e",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "l",
    "i",
    "n",
    "e",
    "a",
    "r",
    "_",
    "s",
    "o",
    "l",
    "v",
    "e",
    "r",
    "=",
    "\"",
    "d",
    "e",
    "n",
    "s",
    "e",
    "_",
    "c",
    "h",
    "o",
    "l",
    "e",
    "s",
    "k",
    "y",
    "\"",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "t",
    "e",
    "r",
    "m",
    "i",
    "n",
    "a",
    "t",
    "i",
    "o",
    "n",
    "=",
    "j",
    "a",
    "x",
    "l",
    "s",
    ".",
    "T",
    "e",
    "r",
    "m",
    "i",
    "n",
    "a",
    "t",
    "i",
    "o",
    "n",
    "C",
    "o",
    "n",
    "f",
    "i",
    "g",
    "(",
    "c",
    "o",
    "s",
    "t",
    "_",
    "t",
    "o",
    "l",
    "e",
    "r",
    "a",
    "n",
    "c",
    "e",
    "=",
    "1",
    "e",
    "-",
    "8",
    ")",
    ",",
    "\n",
    " ",
    " ",
    " ",
    " ",
    ")",
    "\n",
    " ",
    " ",
    " ",
    " ",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    " ",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    ",",
    " ",
    "s",
    "o",
    "l",
    "u",
    "t",
    "i",
    "o",
    "n",
    "[",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    "]",
    "\n",
    "\n",
    "\n",
    "#",
    " ",
    "S",
    "o",
    "l",
    "v",
    "e",
    " ",
    "s",
    "e",
    "q",
    "u",
    "e",
    "n",
    "t",
    "i",
    "a",
    "l",
    "l",
    "y",
    " ",
    "w",
    "i",
    "t",
    "h",
    " ",
    "w",
    "a",
    "r",
    "m",
    "-",
    "s",
    "t",
    "a",
    "r",
    "t",
    "i",
    "n",
    "g",
    ".",
    "\n",
    "i",
    "n",
    "i",
    "t",
    "i",
    "a",
    "l",
    "_",
    "v",
    "a",
    "l",
    "s",
    " ",
    "=",
    " ",
    "j",
    "a",
    "x",
    "l",
    "s",
    ".",
    "V",
    "a",
    "r",
    "V",
    "a",
    "l",
    "u",
    "e",
    "s",
    ".",
    "m",
    "a",
    "k",
    "e",
    "(",
    "[",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    "_",
    "v",
    "a",
    "r",
    "]",
    ")",
    "\n",
    "_",
    ",",
    " ",
    "a",
    "l",
    "l",
    "_",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    " ",
    "=",
    " ",
    "j",
    "a",
    "x",
    ".",
    "l",
    "a",
    "x",
    ".",
    "s",
    "c",
    "a",
    "n",
    "(",
    "s",
    "o",
    "l",
    "v",
    "e",
    "_",
    "f",
    "o",
    "r",
    "_",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    ",",
    " ",
    "i",
    "n",
    "i",
    "t",
    "i",
    "a",
    "l",
    "_",
    "v",
    "a",
    "l",
    "s",
    ",",
    " ",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ")",
    "\n",
    "v",
    "a",
    "r",
    "i",
    "a",
    "n",
    "c",
    "e",
    "s",
    " ",
    "=",
    " ",
    "j",
    "a",
    "x",
    ".",
    "v",
    "m",
    "a",
    "p",
    "(",
    "l",
    "a",
    "m",
    "b",
    "d",
    "a",
    " ",
    "w",
    ":",
    " ",
    "w",
    " ",
    "@",
    " ",
    "c",
    "o",
    "v",
    "a",
    "r",
    "i",
    "a",
    "n",
    "c",
    "e",
    " ",
    "@",
    " ",
    "w",
    ")",
    "(",
    "a",
    "l",
    "l",
    "_",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    ")",
    "\n",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    "_",
    "a",
    "c",
    "h",
    "i",
    "e",
    "v",
    "e",
    "d",
    " ",
    "=",
    " ",
    "j",
    "a",
    "x",
    ".",
    "v",
    "m",
    "a",
    "p",
    "(",
    "l",
    "a",
    "m",
    "b",
    "d",
    "a",
    " ",
    "w",
    ":",
    " ",
    "j",
    "n",
    "p",
    ".",
    "d",
    "o",
    "t",
    "(",
    "w",
    ",",
    " ",
    "e",
    "x",
    "p",
    "e",
    "c",
    "t",
    "e",
    "d",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ")",
    ")",
    "(",
    "a",
    "l",
    "l",
    "_",
    "w",
    "e",
    "i",
    "g",
    "h",
    "t",
    "s",
    ")",
    "\n",
    "\n",
    "p",
    "r",
    "i",
    "n",
    "t",
    "(",
    "f",
    "\"",
    "C",
    "o",
    "m",
    "p",
    "u",
    "t",
    "e",
    "d",
    " ",
    "{",
    "l",
    "e",
    "n",
    "(",
    "t",
    "a",
    "r",
    "g",
    "e",
    "t",
    "_",
    "r",
    "e",
    "t",
    "u",
    "r",
    "n",
    "s",
    ")",
    "}",
    " ",
    "p",
    "o",
    "i",
    "n",
    "t",
    "s",
    " ",
    "o",
    "n",
    " ",
    "t",
    "h",
    "e",
    " ",
    "e",
    "f",
    "f",
    "i",
    "c",
    "i",
    "e",
    "n",
    "t",
    " ",
    "f",
    "r",
    "o",
    "n",
    "t",
    "i",
    "e",
    "r",
    "\"",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-12",
   "metadata": {},
   "source": [
    "## Results\n",
    "\n",
    "Three views of the efficient frontier:\n",
    "1. Objective space: Standard deviation vs. expected return\n",
    "2. Risk-adjusted return: Sharpe ratio (return/risk) along the frontier\n",
    "3. Decision space: Asset allocation across the frontier"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "cell-13",
   "metadata": {
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>                        <script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>\n",
       "        <script charset=\"utf-8\" src=\"https://cdn.plot.ly/plotly-3.1.0.min.js\" integrity=\"sha256-Ei4740bWZhaUTQuD6q9yQlgVCMPBz6CZWhevDYPv93A=\" crossorigin=\"anonymous\"></script>                <div id=\"fca76624-9c33-4e8f-9a99-a36cc46ed4b1\" class=\"plotly-graph-div\" style=\"height:400px; width:100%;\"></div>            <script type=\"text/javascript\">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById(\"fca76624-9c33-4e8f-9a99-a36cc46ed4b1\")) {                    Plotly.newPlot(                        \"fca76624-9c33-4e8f-9a99-a36cc46ed4b1\",                        [{\"hovertemplate\":\"Std Dev: $%{x:.0f}\\u003cbr\\u003eReturn: $%{y:.0f}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"line\":{\"color\":\"steelblue\",\"width\":2},\"marker\":{\"color\":[0.5677857516805246,0.5677857516805246,0.5677857516805246,0.5677857516805246,0.604278203271465,0.6618071650103663,0.7164155897202766,0.7676635257375372,0.8152307533458613,0.8589362989844566,0.8987029257210847,0.9345591004086757,0.9666289256837949,0.9950977733705652,1.020185346045964,1.0422009464332784,1.0613676030654497,1.0779772651719404,1.0923002237200674,1.1045843087560199,1.1150606190896104,1.1239682785399492,1.1314758334718409,1.137766062891188,1.1429978246110877,1.1473060719331363,1.1508093768966456,1.1536188359550685,1.155826706512927,1.157294799608629,1.1562592901473019,1.1526983613892414,1.1470369270152416,1.1398080887439483,1.1312520604808007,1.1217267420311903,1.1114953534927268,1.1007794863739648,1.089758364240171,1.078579930177138,1.0673657330129378,1.056187250786268,1.0451403628972047,1.0342688367002222,1.0236139882779691,1.0131773341611119,1.0029566669272985,0.9932101616638481,0.9836504946015022,0.9743792032988644],\"colorscale\":[[0.0,\"#440154\"],[0.1111111111111111,\"#482878\"],[0.2222222222222222,\"#3e4989\"],[0.3333333333333333,\"#31688e\"],[0.4444444444444444,\"#26828e\"],[0.5555555555555556,\"#1f9e89\"],[0.6666666666666666,\"#35b779\"],[0.7777777777777778,\"#6ece58\"],[0.8888888888888888,\"#b5de2b\"],[1.0,\"#fde725\"]],\"showscale\":false,\"size\":6},\"mode\":\"lines+markers\",\"showlegend\":false,\"x\":[267.0690760658964,267.0690760658964,267.0690760658964,267.0690760658964,267.2465168478181,268.29484989219554,270.27369530175446,273.16279256539536,276.9333640144867,281.55085063710214,286.97421521967726,293.1579554933352,300.05540775862664,307.61835974200545,315.7937211615207,324.55250787199446,333.8310734780494,343.5928716310018,353.79978159850265,364.4110500722388,375.38597536303337,386.7209441313272,398.35656856050906,410.2746270953738,422.4581886591298,434.8813146356564,447.5141175448857,460.35489395531147,473.39187470379807,486.6628966174434,500.9939175003284,516.4857495261531,533.044910438609,550.5198464527587,568.8895485800227,588.0454617762174,607.916145156345,628.4314999329586,649.5330416243364,671.1617695573917,693.2596638226322,715.8223884125866,738.761829461149,762.0637917057654,785.6902834619286,809.6470860729329,833.9207269441366,858.2853207339575,882.9578226733529,907.8503253727629],\"y\":[151.63801610469818,151.63801610469818,151.63801610469818,151.63801610469818,161.4912450313568,177.55945399403572,193.62828880548477,209.69711244106293,225.76459497213364,241.83424562215805,257.9045668244362,273.9734351634979,290.0422364473343,306.11034482717514,322.16812670230865,338.24893087148666,354.31748628616333,370.3853040933609,386.45558059215546,402.5227278470993,418.5781180858612,434.6620738506317,450.7308304309845,466.79654717445374,482.8687906265259,498.94197285175323,515.0034427642822,531.0740768909454,547.1589714288712,563.212439417839,579.2788714170456,595.3522771596909,611.4221960306168,627.4869740009308,643.5574740171432,659.6263200044632,675.6959706544876,691.7645037174225,707.8340649604797,723.9016145467758,739.9616092443466,756.04248046875,772.1098065376282,788.1788313388824,804.2435646057129,820.3160762786865,836.3863527774811,852.4577021598816,868.5218989849091,884.5904767513275],\"type\":\"scatter\",\"xaxis\":\"x\",\"yaxis\":\"y\"},{\"hovertemplate\":\"Return: $%{x:.0f}\\u003cbr\\u003eSharpe: %{y:.2f}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"line\":{\"color\":\"steelblue\",\"width\":2},\"marker\":{\"color\":[0.5677857516805246,0.5677857516805246,0.5677857516805246,0.5677857516805246,0.604278203271465,0.6618071650103663,0.7164155897202766,0.7676635257375372,0.8152307533458613,0.8589362989844566,0.8987029257210847,0.9345591004086757,0.9666289256837949,0.9950977733705652,1.020185346045964,1.0422009464332784,1.0613676030654497,1.0779772651719404,1.0923002237200674,1.1045843087560199,1.1150606190896104,1.1239682785399492,1.1314758334718409,1.137766062891188,1.1429978246110877,1.1473060719331363,1.1508093768966456,1.1536188359550685,1.155826706512927,1.157294799608629,1.1562592901473019,1.1526983613892414,1.1470369270152416,1.1398080887439483,1.1312520604808007,1.1217267420311903,1.1114953534927268,1.1007794863739648,1.089758364240171,1.078579930177138,1.0673657330129378,1.056187250786268,1.0451403628972047,1.0342688367002222,1.0236139882779691,1.0131773341611119,1.0029566669272985,0.9932101616638481,0.9836504946015022,0.9743792032988644],\"colorscale\":[[0.0,\"#440154\"],[0.1111111111111111,\"#482878\"],[0.2222222222222222,\"#3e4989\"],[0.3333333333333333,\"#31688e\"],[0.4444444444444444,\"#26828e\"],[0.5555555555555556,\"#1f9e89\"],[0.6666666666666666,\"#35b779\"],[0.7777777777777778,\"#6ece58\"],[0.8888888888888888,\"#b5de2b\"],[1.0,\"#fde725\"]],\"showscale\":false,\"size\":6},\"mode\":\"lines+markers\",\"showlegend\":false,\"x\":[151.63801610469818,151.63801610469818,151.63801610469818,151.63801610469818,161.4912450313568,177.55945399403572,193.62828880548477,209.69711244106293,225.76459497213364,241.83424562215805,257.9045668244362,273.9734351634979,290.0422364473343,306.11034482717514,322.16812670230865,338.24893087148666,354.31748628616333,370.3853040933609,386.45558059215546,402.5227278470993,418.5781180858612,434.6620738506317,450.7308304309845,466.79654717445374,482.8687906265259,498.94197285175323,515.0034427642822,531.0740768909454,547.1589714288712,563.212439417839,579.2788714170456,595.3522771596909,611.4221960306168,627.4869740009308,643.5574740171432,659.6263200044632,675.6959706544876,691.7645037174225,707.8340649604797,723.9016145467758,739.9616092443466,756.04248046875,772.1098065376282,788.1788313388824,804.2435646057129,820.3160762786865,836.3863527774811,852.4577021598816,868.5218989849091,884.5904767513275],\"y\":[0.5677857516805246,0.5677857516805246,0.5677857516805246,0.5677857516805246,0.604278203271465,0.6618071650103663,0.7164155897202766,0.7676635257375372,0.8152307533458613,0.8589362989844566,0.8987029257210847,0.9345591004086757,0.9666289256837949,0.9950977733705652,1.020185346045964,1.0422009464332784,1.0613676030654497,1.0779772651719404,1.0923002237200674,1.1045843087560199,1.1150606190896104,1.1239682785399492,1.1314758334718409,1.137766062891188,1.1429978246110877,1.1473060719331363,1.1508093768966456,1.1536188359550685,1.155826706512927,1.157294799608629,1.1562592901473019,1.1526983613892414,1.1470369270152416,1.1398080887439483,1.1312520604808007,1.1217267420311903,1.1114953534927268,1.1007794863739648,1.089758364240171,1.078579930177138,1.0673657330129378,1.056187250786268,1.0451403628972047,1.0342688367002222,1.0236139882779691,1.0131773341611119,1.0029566669272985,0.9932101616638481,0.9836504946015022,0.9743792032988644],\"type\":\"scatter\",\"xaxis\":\"x2\",\"yaxis\":\"y2\"},{\"hovertemplate\":\"IBM: $%{y:.0f}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"marker\":{\"color\":\"#2196F3\"},\"name\":\"IBM\",\"x\":[97.21581637859344,113.28469589352608,129.35356423258781,145.42244374752045,161.49131208658218,177.56019160151482,193.62907111644745,209.6979394555092,225.7668301463127,241.83569848537445,257.9045668244362,273.9734351634979,290.04232585430145,306.1111941933632,322.1800848841667,338.24895322322845,354.3178215622902,370.3867122530937,386.45558059215546,402.524471282959,418.59331727027893,434.66220796108246,450.7310539484024,466.79994463920593,482.86883533000946,498.937726020813,515.0065720081329,531.0754626989365,547.14435338974,563.2131993770599,579.2820900678635,595.350980758667,611.4198267459869,627.4887174367905,643.557608127594,659.6264541149139,675.6953448057175,691.7641907930374,707.8330814838409,723.9019721746445,739.970862865448,756.039708852768,772.1085548400879,788.177490234375,804.246336221695,820.3151822090149,836.384117603302,852.452963590622,868.5218095779419,884.590744972229],\"y\":[159.79671478271484,159.79671478271484,159.79671478271484,159.79671478271484,169.831782579422,186.20070815086365,202.56975293159485,218.9386934041977,235.29939353466034,251.67134404182434,268.04661750793457,284.41569209098816,300.78452825546265,317.15235114097595,333.5098624229431,349.89166259765625,366.25936627388,382.6282024383545,398.9987373352051,415.3631329536438,431.7203760147095,448.1056332588196,464.4741117954254,480.8287024497986,497.21279740333557,513.5536193847656,529.937744140625,546.3173985481262,562.6533031463623,561.2956881523132,533.2340598106384,505.15031814575195,476.8584370613098,449.0385353565216,420.97023129463196,392.90574193000793,364.8402988910675,336.77688241004944,308.71039628982544,280.64754605293274,252.59879231452942,224.51284527778625,196.4511275291443,168.3860868215561,140.31648635864258,112.15563118457794,83.82323384284973,56.110929697752,28.06464210152626,0.0005398109124143957],\"type\":\"bar\",\"xaxis\":\"x3\",\"yaxis\":\"y3\"},{\"hovertemplate\":\"WMT: $%{y:.0f}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"marker\":{\"color\":\"#4CAF50\"},\"name\":\"WMT\",\"x\":[97.21581637859344,113.28469589352608,129.35356423258781,145.42244374752045,161.49131208658218,177.56019160151482,193.62907111644745,209.6979394555092,225.7668301463127,241.83569848537445,257.9045668244362,273.9734351634979,290.04232585430145,306.1111941933632,322.1800848841667,338.24895322322845,354.3178215622902,370.3867122530937,386.45558059215546,402.524471282959,418.59331727027893,434.66220796108246,450.7310539484024,466.79994463920593,482.86883533000946,498.937726020813,515.0065720081329,531.0754626989365,547.14435338974,563.2131993770599,579.2820900678635,595.350980758667,611.4198267459869,627.4887174367905,643.557608127594,659.6264541149139,675.6953448057175,691.7641907930374,707.8330814838409,723.9019721746445,739.970862865448,756.039708852768,772.1085548400879,788.177490234375,804.246336221695,820.3151822090149,836.384117603302,852.452963590622,868.5218095779419,884.590744972229],\"y\":[814.6801590919495,814.6801590919495,814.6801590919495,814.6801590919495,794.8687672615051,762.5583410263062,730.2469611167908,697.9356408119202,665.6320095062256,633.3174109458923,600.999653339386,568.6882734298706,536.3770127296448,504.06748056411743,471.77863121032715,439.4426941871643,407.1325659751892,374.8226463794708,342.5082862377167,310.20236015319824,277.916818857193,245.57435512542725,213.26345205307007,180.9665858745575,148.63990247249603,116.34362488985062,84.03071761131287,51.70930176973343,19.401470199227333,0.0001571254415466683,0.0009557152225170285,0.008923031600716058,0.17297564772889018,-6.129994289949536e-7,0.0007700818969169632,0.000526002622791566,0.00008095148018583131,-0.0004846434080718609,3.512340640554612e-6,0.00024615138727313024,0.00004443711532076122,0.00015339594483521068,4.849901813486213e-6,0.00005637048161588609,0.008778004485066049,0.0740181130822748,0.266934628598392,0.007597582680318737,3.029274608934429e-7,0.000016203532737790738],\"type\":\"bar\",\"xaxis\":\"x3\",\"yaxis\":\"y3\"},{\"hovertemplate\":\"SEHI: $%{y:.0f}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"marker\":{\"color\":\"#FF9800\"},\"name\":\"SEHI\",\"x\":[97.21581637859344,113.28469589352608,129.35356423258781,145.42244374752045,161.49131208658218,177.56019160151482,193.62907111644745,209.6979394555092,225.7668301463127,241.83569848537445,257.9045668244362,273.9734351634979,290.04232585430145,306.1111941933632,322.1800848841667,338.24895322322845,354.3178215622902,370.3867122530937,386.45558059215546,402.524471282959,418.59331727027893,434.66220796108246,450.7310539484024,466.79994463920593,482.86883533000946,498.937726020813,515.0065720081329,531.0754626989365,547.14435338974,563.2131993770599,579.2820900678635,595.350980758667,611.4198267459869,627.4887174367905,643.557608127594,659.6264541149139,675.6953448057175,691.7641907930374,707.8330814838409,723.9019721746445,739.970862865448,756.039708852768,772.1085548400879,788.177490234375,804.246336221695,820.3151822090149,836.384117603302,852.452963590622,868.5218095779419,884.590744972229],\"y\":[25.523129850625992,25.523129850625992,25.523129850625992,25.523129850625992,35.299405455589294,51.240988075733185,67.18333065509796,83.12567323446274,99.06858205795288,115.01118540763855,130.95368444919586,146.89607918262482,162.838414311409,178.78016829490662,194.7116106748581,210.66568791866302,226.6080379486084,242.54915118217468,258.4929168224335,274.4343876838684,290.3628647327423,306.3199818134308,322.26237654685974,338.2047116756439,354.1472852230072,370.10282278060913,386.0316872596741,401.9734263420105,417.9452359676361,438.7041926383972,466.76501631736755,494.8406517505646,522.9686498641968,550.961434841156,579.0291428565979,607.0937514305115,635.1596713066101,663.2236242294312,691.2896633148193,719.3522453308105,747.4012970924377,775.4870653152466,803.5489320755005,831.6139578819275,859.6747517585754,887.7703547477722,915.9098863601685,943.8815712928772,971.9353318214417,999.999463558197],\"type\":\"bar\",\"xaxis\":\"x3\",\"yaxis\":\"y3\"}],                        {\"template\":{\"data\":{\"histogram2dcontour\":[{\"type\":\"histogram2dcontour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"choropleth\":[{\"type\":\"choropleth\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"histogram2d\":[{\"type\":\"histogram2d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmap\":[{\"type\":\"heatmap\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"contourcarpet\":[{\"type\":\"contourcarpet\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"contour\":[{\"type\":\"contour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"surface\":[{\"type\":\"surface\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"mesh3d\":[{\"type\":\"mesh3d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"scatter\":[{\"fillpattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2},\"type\":\"scatter\"}],\"parcoords\":[{\"type\":\"parcoords\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolargl\":[{\"type\":\"scatterpolargl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"bar\":[{\"error_x\":{\"color\":\"#2a3f5f\"},\"error_y\":{\"color\":\"#2a3f5f\"},\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"scattergeo\":[{\"type\":\"scattergeo\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolar\":[{\"type\":\"scatterpolar\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"scattergl\":[{\"type\":\"scattergl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatter3d\":[{\"type\":\"scatter3d\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermap\":[{\"type\":\"scattermap\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermapbox\":[{\"type\":\"scattermapbox\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterternary\":[{\"type\":\"scatterternary\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattercarpet\":[{\"type\":\"scattercarpet\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"baxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"type\":\"carpet\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#EBF0F8\"},\"line\":{\"color\":\"white\"}},\"header\":{\"fill\":{\"color\":\"#C8D4E3\"},\"line\":{\"color\":\"white\"}},\"type\":\"table\"}],\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}]},\"layout\":{\"autotypenumbers\":\"strict\",\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#2a3f5f\"},\"hovermode\":\"closest\",\"hoverlabel\":{\"align\":\"left\"},\"paper_bgcolor\":\"white\",\"plot_bgcolor\":\"#E5ECF6\",\"polar\":{\"bgcolor\":\"#E5ECF6\",\"angularaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"radialaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"ternary\":{\"bgcolor\":\"#E5ECF6\",\"aaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"caxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]]},\"xaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"yaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"yaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"zaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2}},\"shapedefaults\":{\"line\":{\"color\":\"#2a3f5f\"}},\"annotationdefaults\":{\"arrowcolor\":\"#2a3f5f\",\"arrowhead\":0,\"arrowwidth\":1},\"geo\":{\"bgcolor\":\"white\",\"landcolor\":\"#E5ECF6\",\"subunitcolor\":\"white\",\"showland\":true,\"showlakes\":true,\"lakecolor\":\"white\"},\"title\":{\"x\":0.05},\"mapbox\":{\"style\":\"light\"}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,0.28600000000000003],\"title\":{\"text\":\"Std Dev ($)\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"Return ($)\"}},\"xaxis2\":{\"anchor\":\"y2\",\"domain\":[0.3526666666666667,0.6386666666666667],\"title\":{\"text\":\"Return ($)\"}},\"yaxis2\":{\"anchor\":\"x2\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"Sharpe Ratio\"}},\"xaxis3\":{\"anchor\":\"y3\",\"domain\":[0.7053333333333334,1.0],\"title\":{\"text\":\"Target Return ($)\"}},\"yaxis3\":{\"anchor\":\"x3\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"Investment ($)\"},\"range\":[0,1050]},\"annotations\":[{\"font\":{\"size\":16},\"showarrow\":false,\"text\":\"Efficient Frontier\",\"x\":0.14300000000000002,\"xanchor\":\"center\",\"xref\":\"paper\",\"y\":1.0,\"yanchor\":\"bottom\",\"yref\":\"paper\"},{\"font\":{\"size\":16},\"showarrow\":false,\"text\":\"Sharpe Ratio\",\"x\":0.4956666666666667,\"xanchor\":\"center\",\"xref\":\"paper\",\"y\":1.0,\"yanchor\":\"bottom\",\"yref\":\"paper\"},{\"font\":{\"size\":16},\"showarrow\":false,\"text\":\"Asset Allocation\",\"x\":0.8526666666666667,\"xanchor\":\"center\",\"xref\":\"paper\",\"y\":1.0,\"yanchor\":\"bottom\",\"yref\":\"paper\"}],\"margin\":{\"t\":40,\"b\":40,\"l\":60,\"r\":40},\"legend\":{\"orientation\":\"h\",\"yanchor\":\"bottom\",\"y\":-0.25,\"xanchor\":\"center\",\"x\":0.83},\"barmode\":\"stack\",\"height\":400},                        {\"responsive\": true}                    )                };            </script>        </div>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import plotly.graph_objects as go\n",
    "from plotly.subplots import make_subplots\n",
    "from IPython.display import HTML\n",
    "import math\n",
    "\n",
    "# Annualize returns and risk (monthly data -> yearly)\n",
    "annual_factor = 12\n",
    "risk_free_rate = 0.0\n",
    "\n",
    "# Convert JAX arrays to Python floats for Plotly.\n",
    "std_devs_annual = [float(jnp.sqrt(v)) * math.sqrt(annual_factor) for v in variances]\n",
    "returns_annual = [float(r) * annual_factor for r in returns_achieved]\n",
    "sharpe_ratios = [\n",
    "    (r - risk_free_rate) / s if s > 0 else 0.0\n",
    "    for r, s in zip(returns_annual, std_devs_annual)\n",
    "]\n",
    "\n",
    "colors = [\"#2196F3\", \"#4CAF50\", \"#FF9800\"]\n",
    "\n",
    "fig = make_subplots(\n",
    "    rows=1,\n",
    "    cols=3,\n",
    "    subplot_titles=(\"Efficient Frontier\", \"Sharpe Ratio\", \"Asset Allocation\"),\n",
    "    column_widths=[0.33, 0.33, 0.34],\n",
    ")\n",
    "\n",
    "# Scale to $1000 investment.\n",
    "std_dev_dollars = [s * 1000 for s in std_devs_annual]\n",
    "return_dollars = [r * 1000 for r in returns_annual]\n",
    "# Use target returns for bar chart x-axis to avoid overlapping bars.\n",
    "# (achieved returns can be identical for low targets that fall below min-variance portfolio)\n",
    "target_dollars = [float(t) * annual_factor * 1000 for t in target_returns]\n",
    "\n",
    "# Left plot: Efficient frontier (std dev vs return)\n",
    "fig.add_trace(\n",
    "    go.Scatter(\n",
    "        x=std_dev_dollars,\n",
    "        y=return_dollars,\n",
    "        mode=\"lines+markers\",\n",
    "        marker=dict(size=6, color=sharpe_ratios, colorscale=\"Viridis\", showscale=False),\n",
    "        line=dict(color=\"steelblue\", width=2),\n",
    "        hovertemplate=\"Std Dev: $%{x:.0f}<br>Return: $%{y:.0f}<extra></extra>\",\n",
    "        showlegend=False,\n",
    "    ),\n",
    "    row=1,\n",
    "    col=1,\n",
    ")\n",
    "\n",
    "# Middle plot: Sharpe ratio vs return.\n",
    "fig.add_trace(\n",
    "    go.Scatter(\n",
    "        x=return_dollars,\n",
    "        y=sharpe_ratios,\n",
    "        mode=\"lines+markers\",\n",
    "        marker=dict(size=6, color=sharpe_ratios, colorscale=\"Viridis\", showscale=False),\n",
    "        line=dict(color=\"steelblue\", width=2),\n",
    "        hovertemplate=\"Return: $%{x:.0f}<br>Sharpe: %{y:.2f}<extra></extra>\",\n",
    "        showlegend=False,\n",
    "    ),\n",
    "    row=1,\n",
    "    col=2,\n",
    ")\n",
    "\n",
    "# Right plot: Asset allocation vs target return.\n",
    "for i, (name, color) in enumerate(zip(stock_names, colors)):\n",
    "    fig.add_trace(\n",
    "        go.Bar(\n",
    "            x=target_dollars,\n",
    "            y=[float(w) * 1000 for w in all_weights[:, i]],\n",
    "            name=name,\n",
    "            marker_color=color,\n",
    "            hovertemplate=f\"{name}: $%{{y:.0f}}<extra></extra>\",\n",
    "        ),\n",
    "        row=1,\n",
    "        col=3,\n",
    "    )\n",
    "\n",
    "fig.update_xaxes(title_text=\"Std Dev ($)\", row=1, col=1)\n",
    "fig.update_yaxes(title_text=\"Return ($)\", row=1, col=1)\n",
    "fig.update_xaxes(title_text=\"Return ($)\", row=1, col=2)\n",
    "fig.update_yaxes(title_text=\"Sharpe Ratio\", row=1, col=2)\n",
    "fig.update_xaxes(title_text=\"Target Return ($)\", row=1, col=3)\n",
    "fig.update_yaxes(title_text=\"Investment ($)\", range=[0, 1050], row=1, col=3)\n",
    "\n",
    "fig.update_layout(\n",
    "    barmode=\"stack\",\n",
    "    height=400,\n",
    "    margin=dict(t=40, b=40, l=60, r=40),\n",
    "    legend=dict(orientation=\"h\", yanchor=\"bottom\", y=-0.25, xanchor=\"center\", x=0.83),\n",
    ")\n",
    "HTML(fig.to_html(full_html=False, include_plotlyjs=\"cdn\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cell-14",
   "metadata": {},
   "source": [
    "The efficient frontier shows the optimal trade-off between risk (standard deviation)\n",
    "and return. SEHI has the highest expected return but also highest\n",
    "risk, while WMT provides stability. The optimal allocation shifts from WMT-heavy (low risk)\n",
    "to SEHI-heavy (high return) as we move along the frontier.\n",
    "\n",
    "For more details, see {class}`jaxls.Cost` and {class}`jaxls.LeastSquaresProblem`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
